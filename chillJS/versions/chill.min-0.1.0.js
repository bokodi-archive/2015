!function(t){"use strict";function e(t,e){var n=e.match(t);return null===n?null:n[0]}function n(t){return"[object Array]"===Object.prototype.toString.call(t)}function r(t){return"boolean"==typeof t}function i(t){return"function"==typeof t}function s(t){return"[object Object]"===Object.prototype.toString.call(t)}function o(t){return"string"==typeof t}function a(t){return"number"==typeof t}function h(t){return void 0===t}function u(t){return null===t}function c(t,e){return t instanceof e}function l(){return Object.create(null)}function d(t){var e=null;return"function"==typeof t&&(e=Object.create(t.prototype),t.call(e)),e}function f(t,e,n){return Array.prototype.slice.call(t,e,n)}function p(t){return"string"==typeof t&&"%"===t.slice(-1)}function m(e){return t.parseInt(e,10)}function y(t,e,n){return Math.max(t,Math.min(e,n))}function g(t){return t*Math.PI/180}function v(t,e){for(var n="";e-->0;)n+=t;return n}function b(t){return void console.warn(t)}function x(t){throw new Error(t)}function T(t,e,n){for(var r=-1;++r<t;)e.call(n,r);return n}function w(t,e){return 0===t.indexOf(e)}function L(t,e){var n=t.lastIndexOf(e);return-1!==n&&n===t.length-e.length}function E(t,e,n){var r,i=0;for(void 0===n&&(n=1);-1!==(r=t.indexOf(e))&&(t.splice(r,1),!(++i>=n)););return i}function S(t){for(;t.length>0;)t.pop();return t}function O(t,e){return-1!==t.indexOf(e)}function k(t,e){return O(t,e)||t.push(e),t}function j(t){return"[object Array]"===Object.prototype.toString.call(t)?t:[t]}function C(t,e,n){for(var r=0,i=t.length;i>r&&e.call(n,t[r],r,t)!==!0;r++);return t}function W(t,e){for(var n=0,r=t.length;r>n&&e.call(t[n],n,t)!==!0;n++);return t}function A(t,e){for(var n=Array.prototype.slice.call(arguments,2),r=0,i=t.length;i>r;r++)e.apply(t[r],n);return t}function P(t){for(var e,n=Array.prototype.slice.call(arguments,1),r=0,i=n.length;i>r;r++)e=n[r],B(e,function(e,n){t[e]=n});return t}function X(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Y(t){for(var e,n=Array.prototype.slice.call(arguments,1),r=0,i=n.length;i>r;r++)e=n[r],B(e,function(e,n){X(t,e)||(t[e]=n)});return t}function R(t){var e=[];return B(t,function(t){e.push(t)}),e}function B(t,e,n){var r;for(r in t)if(X(t,r)&&e.call(n,r,t[r],t)===!0)break;return t}function I(t,e){for(var n,r={},i=0,s=e.length;s>i;i++)n=e[i],r[n]=t[n];return r}function M(t,e,n,r){var i;return t.readyState>0&&(n===!0&&(t.pause(),t.currentTime=0),"function"==typeof r&&(i=function(e){r.call(this,e),t.removeEventListener("ended",i)},t.addEventListener("ended",i)),void 0!==e&&(t.volume=Math.min(Math.max(0,e/100),1)),t.play()),t}function F(e,n,r){var i=t.document.createElement(e);return void 0!==n&&n.appendChild(i),void 0!==r&&(i.textContent=r),i}function H(){N.apply(this,Array.prototype.slice.call(arguments))}function N(){for(var t,e,n=0,r=arguments.length,i=Object.prototype.toString,s=Object.prototype.hasOwnProperty;r>n;n++)if(t=arguments[n],"string"==typeof t)this[t]=t;else if("[object Array]"===i.call(t))N.apply(this,t);else if("[object Object]"===i.call(t))for(e in t)s.call(t,e)&&(this[e]=t[e])}function D(t){this.type=t,this.data={},this.timeStamp=(new Date).getTime()}function z(){this.eventList={}}function q(){var t=Object.create(null),e=!0;this.count=0,this.add=function(n,r){return"number"==typeof r&&r===r|0&&isFinite(r)||(r=this.lastID()||0),void 0===t[r]&&(t[r]=[],e=!0),t[r].push(n),++this.count,this},this.addBefore=function(e,n){var r,i=this.getOrderOf(n);return null!==i&&(r=t[i].indexOf(n),-1!==r&&(t[i].splice(r,0,e),++this.count)),this},this.addAfter=function(e,n){var r,i=this.getOrderOf(n);return null!==i&&(r=t[i].indexOf(n),-1!==r&&(t[i].splice(r+1,0,e),++this.count)),this},this.remove=function(e){var n,r=this.getOrderOf(e),i=null;return null!==r&&(n=t[r].indexOf(e),-1!==n&&(i=t[r].splice(n,1)[0],--this.count)),i},this.has=function(t){return null!==this.getOrderOf(t)},this.reOrder=function(t,e){return this.remove(t).add(t,e)},this.clear=function(){return this.order={},this.count=0,e=!0,this},this.each=function(e,n){var r=0;return this.getOrders().forEach(function(i){t[i].forEach(function(t){e.call(n,t,r++)})}),this},this.execute=function(e,n){for(var r,i,s,o=this.getOrders(),a=0,h=o.length-1;h>=0;--h)for(i=t[o[h]],r=i.length-1;r>=0;--r)if(s=e.call(n,i[r],a++),void 0!==s)return s;return null},this.firstID=function(){var t=this.getOrders()[0];return void 0===t?null:t},this.lastID=function(){var t=this.getOrders().slice(-1)[0];return void 0===t?null:t},this.first=function(){var e=t[this.firstID()];return void 0!==e&&e.length>0?e[0]:null},this.last=function(){var e=t[this.lastID()];return void 0!==e&&e.length>0?e.slice(-1)[0]:null},this.getOrders=function(){function n(t,e){return t-e}var r=null;return function(){return e&&(r=Object.keys(t).sort(n),e=!1),r}}(),this.all=function(){var t=[];return this.each(function(e){t.push(e)}),t},this.getOrderOf=function(e){var n,r=null,i=Object.prototype.hasOwnProperty;for(n in t)if(i.call(t,n)&&-1!==t[n].indexOf(e)){r=n;break}return r}}function Q(){this.data={}}function U(){var t=Object.prototype.hasOwnProperty,e={};this.get=function(n){return t.call(e,n)?e[n]:null},this.set=function(t,n){return e[t]=n},this.edit=function(n){var r;for(r in n)t.call(n,r)&&(e[r]=n[r]);return this},this.getAll=function(){var n,r={};for(n in e)t.call(e,n)&&(r[n]=e[n]);return r}}function V(){var t=Object.prototype.hasOwnProperty,e={};this.get=function(n){return t.call(e,n)?e[n]:null},this.set=function(t,n){return e[t]=n}}function G(t,e){this.x=t||0,this.y=e||0}function J(){this.pos=new G}function $(t){G.call(this),this.type=t}function _(){q.call(this)}function K(t){z.call(this),this.reset()}function Z(){this.taskList=[]}function tt(t,e,n){this.listener=t,this.interval=e||0,this.thisArg=n||this,this.reset()}function et(){this.items=Object.create(null)}function nt(t,e,n,r){D.call(this,t),this.x=e,this.y=n,this.button=r}function rt(t,e){D.call(this,t),this.keyCode=e,this.character=String.fromCharCode(e).toLowerCase()}function it(t,e,n,r){D.call(this,t),this.dragStartX=e,this.dragStartY=n,this.dragged=Array.prototype.concat(r)}function st(t,e){D.call(this,t),this.target=e}function ot(t,e){D.call(this,t),this.objectives=Array.prototype.concat(e)}function at(){z.call(this),V.call(this),me.call(this),this.uuid=Xt(),this.velocity=new G(0,0),this.classList=new _,this.classList.add(pe.elementType,0),B(ye,this.addProp,this)}function ht(t){z.call(this),ut.call(this),this.uuid=Xt(),this.canvas=F("canvas"),this.ctx=this.canvas.getContext("2d"),Bt(this,t)}function ut(){function t(t){return t.parentLayer===e&&c(t.parentElement,gt)&&e.contains(t)}var e=this,r=l(),i=new gt("body");return this.body=r.body=i,this.add=function(t,e,n){if(c(t,at)){if(c(t,gt)){if(X(r,t.id))return b("unable to add container#"+t.id+', "'+t.id+'" already exists in layer#'+this.id),this;r[t.id]=t}X(r,e)||(h(e)||b('"'+e+'" does not exists in layer#'+this.id+", use #body by default"),e="body"),r[e].add(t,n),t.parentLayer=this,t.parentElement=r[e]}else b("only elements can be added to layer#"+this.id);return this},this.getElementByID=function(t){var e=null;return this.eachElement(function(n){n.id===t&&(e=n)}),e},this.contains=function(t){var e=!1;return this.eachContainer(function(n){return n===t||n.has(t)?e=!0:void 0}),e},this.remove=function(t){var e=null;return t===i?b("cannot remove #body from layer#"+this.id):this.eachContainer(function(n,i){return n===t?(delete r[i],e=t):n.has(t)?(n.remove(t),t.parentLayer=null,t.parentElement=null,e=t):void 0}),e},this.create=function(t){var e,n,r,i=null;return w(t,"#")?(t=t.slice(1),r=he.get(t),u(r)?b('AbstractElement "'+t+'" does not exist'):(i=r.instantiate(),u(i)?b('Unable to instantiate AbstractElement. Element "'+r.type+'" is not instantiatable or does not exists'):i.edit(arguments[1]))):(e=ae.getInstantiatable(t),u(e)?b('Unable to instantiate Element. "'+r.type+'" is not instantiatable or does not exists'):(n=f(arguments,1),n.unshift(null),i=new(Function.prototype.bind.apply(e,n)))),i},this.insert=function(t,e,r,i){var s=n(e)?this.create.apply(this,[t].concat(e)):this.create(t,e);return this.add(s,r,i),s},this.moveBefore=function(e,n){return t(e)&&t(n)&&(e.parentElement.remove(e),n.parentElement.addBefore(e,n),e.parentElement=n.parentElement),this},this.moveAfter=function(e,n){return t(e)&&t(n)&&(e.parentElement.remove(e),n.parentElement.addAfter(e,n),e.parentElement=n.parentElement),this},this.select=function(t,e){return[]},this.eachElement=function(t,e){return t.call(e,i),i.each(t,e),this},this.eachContainer=function(t,e){var n;for(n in r)if(!h(t.call(e,r[n],n)))break;return this},this}function ct(t){z.call(this),V.call(this),this.uuid=Xt(),this.wrapper=t,this.readyState="pending",this.screen=new J,this.cursor=new $("mouse"),this.settings=new Q,this.loader=new K,this.queue=new Z,lt.call(this),dt.call(this,t),ft.call(this),pt.call(this),mt.call(this)}function lt(){var t=new q;return this.createLayer=function(t){return s(t)||(t=l()),new ht(Y(t,{width:this.screen.width,height:this.screen.height}))},this.addLayer=function(e,n){return t.add(e,n),e.root=this,this.wrapper.appendChild(e.canvas),this},this.insertLayer=function(t,e){var n=this.createLayer(t);return this.addLayer(n,e),n},this.removeLayer=function(e){return t.remove(e),e.root=null,this.wrapper.removeChild(e.canvas),this},this.getLayer=function(e){var n=null;return t.each(function(t){return t.id===e?(n=t,!0):!1}),n},this.eachLayer=function(e){return t.each(e),this},this.eachElement=function(e){return t.each(function(t){t.eachElement(e)}),this},this}function dt(e){var n=this,r=[],i=[],s=t.document;return this.getDraggedElements=function(){return r},this.getFocusedElements=function(){return i},this.updateFocusedElements=function(t){var e=[],r=this.cursor.x,s=this.cursor.y;return this.cursor.onScreen&&n.eachElement(function(n){var o,a;return t.propagationStopped===!0?void 0:(o=O(i,n),t.target=n,n.dispatchEvent(t.type,t),void(n.screenX<=r&&n.screenXE>=r&&n.screenY<=s&&n.screenYE>=s?(e.push(n),o||(a=new nt("mouseenter",t.x,t.y,null),a.target=n,n.dispatchEvent(a.type,a))):o&&(a=new nt("mouseleave",t.x,t.y,null),a.target=n,n.dispatchEvent(a.type,a))))}),S(i),i.push.apply(i,e),this},e.addEventListener("mousemove",function(t){var e=t.layerX,r=t.layerY,i=new nt("mousemove",e,r,null);n.cursor.set(e,r),n.cursor.onScreen=!0,i.target=n,i.originalEvent=t,n.dispatchEvent(t.type,i),n.updateFocusedElements(i)}),e.addEventListener("mouseenter",function(t){n.cursor.set(t.layerX,t.layerY),n.cursor.onScreen=!0,n.dispatchEvent(t.type,new nt(t.type,t.layerX,t.layerY,null))}),e.addEventListener("mouseleave",function(t){n.cursor.set(t.layerX,t.layerY),n.cursor.onScreen=!1,C(i,function(t){var e=new nt("mouseleave",n.cursor.x,n.cursor.y,null);e.target=t,t.dispatchEvent(e.type,e)}),S(i),n.dispatchEvent(t.type,new nt(t.type,t.layerX,t.layerY,null))}),e.addEventListener("mousedown",function(t){var e=t.layerX,r=t.layerY,s=new nt("mousedown",e,r,null);switch(n.cursor.set(e,r),n.cursor.onScreen=!0,s.target=n,s.originalEvent=t,t.button){case 0:s.button="left";break;case 1:s.button="middle";break;case 2:s.button="right"}n.dispatchEvent(t.type,s),A(i,z.prototype.dispatchEvent,t.type,s)}),e.addEventListener("mouseup",function(t){var e=t.layerX,r=t.layerY,s=new nt("mouseup",e,r,null);switch(n.cursor.set(e,r),n.cursor.onScreen=!0,s.target=n,s.originalEvent=t,t.button){case 0:s.button="left";break;case 1:s.button="middle";break;case 2:s.button="right"}n.dispatchEvent(t.type,s),A(i,z.prototype.dispatchEvent,t.type,s)}),s.addEventListener("keypress",function(t){var e=t.keyCode||t.which,r=new rt("keypress",e);r.target=n,r.originalEvent=t,n.dispatchEvent("keypress",r)}),s.addEventListener("keydown",function(t){var e=t.keyCode||t.which,r=new rt("keydown",e);r.target=n,r.originalEvent=t,n.dispatchEvent("keydown",r)}),s.addEventListener("keyup",function(t){var e=t.keyCode||t.which,r=new rt("keyup",e);r.target=n,r.originalEvent=t,n.dispatchEvent("keyup",r)}),this}function ft(){var e=null,n=function(){var r=new Date;e=t.requestAnimationFrame(n),this.fps=r-this.lastTick,this.lastTick=r,++this.tickCount,this.update(),this.queue.perform(),this.emit("tick"),this.reflow(),this.checkCollisions(),this.paint()}.bind(this);return this.start=function(){return this.stop(),this.run=!0,n(),this},this.stop=function(){return t.cancelAnimationFrame(e),this.run=!1,this},this}function pt(){function t(t,e,n){this.element=t,this.targets=j(e),this.autoRemove=n!==!1}var e=[],n=t.prototype=l();return n.constructor=t,n.addTarget=function(t){return this.targets=this.targets.concat(t),this},n.removeTarget=function(t){return E(this.targets,t),this},n.check=function(){for(var t,e,n=this.element,r=0,i=this.targets.length;i>r;r++)t=this.targets[r],n.screenX>t.screenXE||n.screenXE<t.screenX||n.screenY>t.screenYE||n.screenYE<t.screenY||(e=new ot("collision",t),e.target=n,n.emit(e.type,e),this.autoRemove===!0&&(this.removeTarget(t),--r,--i));return this},this.watch=function(n,r,i){var s=new t(n,r,i);return e.push(s),s},this.neglect=function(t){return E(e,t),this},this.checkCollisions=function(){return W(e,n.check),this},this}function mt(){return this.settings.edit({volume:40,maxDraggedEntries:1,renderDepthLimit:0}),this}function yt(t,e,n){this.type=t,this.args=h(n)?[]:Array.prototype.concat(n),s(e)&&(this.use=e)}function gt(t,e){at.call(this),vt.call(this),this.id=String(t),this.classList.add(xe.elementType,1),this.edit(e)}function vt(){var t=new q;return this.add=function(e,n){return t.add(e,n),this},this.addBefore=function(e,n){return t.addBefore(e,n),this},this.addAfter=function(e,n){return t.addAfter(e,n),this},this.has=function(e){return t.has(e)},this.remove=function(e){return t.remove(e)},this.count=function(e){var n=t.count;return e===!0&&this.each(function(t){c(t,gt)&&(n+=t.count)}),n},this.getElements=function(){return t.all()},this.first=function(){return t.first()},this.last=function(){return t.last()},this.each=function(e,n,r){return t.each(function(t){e.call(n,t),r!==!1&&c(t,gt)&&t.each(e,n)}),this},this}function bt(){at.call(this),this.classList.add(we.elementType,1),B(Le,this.addProp,this)}function xt(t){this.vertices=[[0,0],[1,1]],bt.call(this),this.classList.add(Ee.elementType,2),this.edit(t)}function Tt(t){this.vertices=[[.5,0],[1,1],[0,1]],bt.call(this),this.classList.add(Se.elementType,2),this.edit(t)}function wt(t){this.vertices=[[0,0],[1,0],[1,1],[0,1]],bt.call(this),this.classList.add(Oe.elementType,2),this.edit(t)}function Lt(t){this.vertices=[[.5,0],[1,.4],[.8,1],[.2,1],[0,.4]],bt.call(this),this.classList.add(ke.elementType,2),this.edit(t)}function Et(t){this.vertices=[[.25,0],[.75,0],[1,.5],[.75,1],[.25,1],[0,.5]],bt.call(this),this.classList.add(je.elementType,2),this.edit(t)}function St(t){this.vertices=[[0,1],[.5,0],[1,1],[0,.3],[1,.3]],bt.call(this),this.classList.add(Ce.elementType,2),this.edit(t)}function Ot(t){at.call(this),this.classList.add(We.elementType,1),B(Ae,this.addPropSafe,this),this.edit(t)}function kt(t){at.call(this),this.classList.add(Pe.elementType,1),B(Xe,this.addProp,this),this.edit(t)}function jt(t){at.call(this),this.classList.add(Ye.elementType,1),B(Re,this.addPropSafe,this),this.edit(t)}function Ct(t){at.call(this),this.classList.add(Be.elementType,1),B(Ie,this.addPropSafe,this),this.img=new Image,this.edit(t)}function Wt(t){at.call(this),this.classList.add(Me.elementType,1),B(Fe,this.addPropSafe,this),this.img=new Image,this.frames=[],this.animations=l(),this.currentAnimationFrame={x:0,y:0},this.edit(t)}t.requestAnimationFrame=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.msRequestAnimationFrame||t.oRequestAnimationFrame,t.cancelAnimationFrame=t.cancelAnimationFrame||t.webkitCancelAnimationFrame||t.mozCancelAnimationFrame||t.msCancelAnimationFrame||t.oCancelAnimationFrame;var At=/[+-]?(?:\d*\.|)\d+/,Pt=/\n/,Xt=function(){function t(t){var e=16*Math.random()|0,n="x"===t?e:3&e|8;return n.toString(16)}var e=/[xy]/g;return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(e,t)}}(),Yt=function(){function t(t){return"[object Array]"===Object.prototype.toString.call(t)}var e=/^{{(.*)}}$/;return function(n,r,i){var s,o=String(n).match(e);return t(o)?(s=new Function(t(i)?i.join(","):"",o[1]),"object"==typeof r?s.bind(r):s):null}}(),Rt=function(){var t=/[+-]?(?:\d*\.|)\d+/;return function(e,n){var r;return"number"!=typeof n?0:(e=String(e),r=e.match(t),null===r?0:Number(r[0])*n/100)}}(),Bt=function(){function t(t,e){for(var n=0,r=t.length;r>n;n++)if(t[n]===e)return!0;return!1}function e(e){var i=typeof e;return t(n,i)?i:null===e?"null":"[object Array]"===r.call(e)?"array":"object"}var n=["string","number","boolean","undefined","function"],r=Object.prototype.toString;return function i(t,n){var r,s,o,a,h,u,c=Object.prototype.hasOwnProperty;for(r in n)if(c.call(n,r)){if(s=t[r],o=n[r],a=e(o),void 0===s)continue;switch(e(s)){case"function":if("array"===a)if(u=o.length,0===u)s.call(t);else for(h=0;u>h;h++)"array"===e(o[h])?s.apply(t,o[h]):s.call(t,o[h]);else s.call(t,o);break;case"string":case"boolean":case"number":case"date":case"undefined":case"null":t[r]=o;break;case"array":"array"===a?s.push.apply(s,o):s.push(o);break;case"object":"object"===a?i(s,o):t[r]=o}}return t}}(),It=function(){function t(t){return t.toUpperCase()}var e=/(?:^|\s)\S/g;return function(n){return n.replace(e,t)}}(),Mt=t.document,Ft=(Mt.body,Object.create(null));Ft.get=function(){function t(t,e){var n=e.target;4===n.readyState&&200===n.status&&t(n.responseText)}return function(e,n){var r=new XMLHttpRequest;return r.open("GET",e,!0),r.onreadystatechange=t.bind(r,n),r.send(null),r}}(),Ft.getJSON=function(t,e){return Ft.get(t,function(t){e(JSON.parse(t))})},Ft.post=function(t,e,n){var r=new XMLHttpRequest;return r.open("POST",t,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=n,r.send(null),r},H.each=function(t,e){var n,r=Object.prototype.hasOwnProperty;for(n in t)r.call(t,n)&&e(n,t[n]);return t};var Ht=H.prototype=Object.create(null);Ht.constructor=H;var Nt=D.prototype=Object.create(null);Nt.constructor=D,Nt.type=null,Nt.originalEvent=null,Nt.target=null,Nt.data=null,Nt.timeStamp=0,Nt.cancelable=!0,Nt.defaultPrevented=!1,Nt.propagationStopped=!1,Nt.returnValue=null,Nt.preventDefault=function(){return this.cancelable===!0&&(this.defaultPrevented=!0),this},Nt.stopPropagation=function(){return this.propagationStopped=!0,this},Nt.toString=function(){return this.type+" Event"},z.transmit=function(t,e,n){return e.on(t,function(){n.dispatchEvent(t)}),n};var Dt=z.prototype=Object.create(null);Dt.constructor=z,Dt.addEventListener=function(t,e){var n=this.eventList[t]||(this.eventList[t]=[]);return n.push(e),this},Dt.hasEventListener=function(t){var e=this.eventList[t];return!!e&&e.length>0},Dt.removeEventListener=function(t,e){var n,r=this.eventList[t];return void 0!==r&&(n=r.indexOf(e),-1!==n&&r.splice(n,1)),this},Dt.removeAllEventListeners=function(){var t,e=this.eventList,n=Object.prototype.hasOwnProperty;for(t in e)n.call(e,t)&&delete e[t];return this},Dt.dispatchEvent=function(t){var e,n,r,i=this.eventList[t];if(void 0!==i)for(e=Array.prototype.slice.call(arguments,1),n=0,r=i.length;r>n;n++)i[n].apply(this,e);return this},Dt.eachEventListener=function(t,e){var n,r,i;if(this.hasEventListener(t))for(n=this.eventList[t],r=0,i=n.length;i>r;r++)e(n[r],r);return this},Dt.on=Dt.addEventListener,Dt.off=Dt.removeEventListener,Dt.offAll=Dt.removeAllEventListeners,Dt.emit=Dt.dispatchEvent,Dt.toString=function(){return"[object EventTarget]"};var zt=q.prototype=Object.create(null);zt.constructor=q,zt.toString=function(){return"[object OrderedList]"};var qt=Q.prototype=Object.create(null);qt.constructor=Q,qt.get=function(t){return Object.prototype.hasOwnProperty.call(this.data,t)?this.data[t]:null},qt.set=function(t,e){return this.data[t]=e},qt.edit=function(t){var e,n=Object.prototype.hasOwnProperty,r=this.data;for(e in t)n.call(t,e)&&(r[e]=t[e]);return this};var Qt=U.prototype=Object.create(null);Qt.constructor=U;var Ut=V.prototype=Object.create(null);Ut.constructor=V;var Vt=G.prototype=Object.create(null);Vt.constructor=G,Vt.x=0,Vt.y=0,Vt.set=function(t,e){return this.x=t,this.y=e,this},Vt.setX=function(t){return this.x=t,this},Vt.setY=function(t){return this.y=t,this},Vt.add=function(t){return this.x+=t.x,this.y+=t.y,this},Vt.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},Vt.addScalar=function(t){return this.x+=t,this.y+=t,this},Vt.sub=function(t){return this.x-=t.x,this.y-=t.y,this},Vt.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},Vt.subScalar=function(t){return this.x-=t,this.y-=t,this},Vt.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},Vt.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},Vt.divide=function(t){return this.x=0===t.x?0:this.x/t.x,this.y=0===t.y?0:this.y/t.y,this},Vt.divideScalar=function(t){return this.x=0===t?0:this.x/t,this.y=0===t?0:this.y/t,this},Vt.min=function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this},Vt.max=function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this},Vt.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},Vt.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},Vt.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},Vt.negate=function(){return this.x=-this.x,this.y=-this.y,this},Vt.rotate=function(t){var e=Math.cos(t),n=Math.sin(t),r=this.x*e-this.y*n,i=this.x*n+this.y*e;return this.x=r,this.y=i,this},Vt.setLength=function(t){return this.normalize().multiplyScalar(t.length()),this},Vt.dot=function(t){return this.x*t.x+this.y*t.y},Vt.cross=function(t){return this.x*t.y-this.y*t.x},Vt.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Vt.normalize=function(){return this.divideScalar(this.length())},Vt.toAngle=function(t){return this.rotate(2*Math.PI-Math.atan2(this.y,this.x)+t),this},Vt.projectTo=function(t){var e=t.start,n=t.delta(),r=this.angleTo(n)>0?new G(n.y,-n.x):new G(-n.y,n.x),i=(this.y*n.x+n.y*e.x-e.y*n.x-n.y*this.x)/(r.x*n.y-r.y*n.x),s=(this.x+r.x*i-e.x)/n.x;return 0>i||0>s?null:new G(this.x+r.x*i,this.y+r.y*i)},Vt.distanceTo=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},Vt.angleTo=function(t){return Math.atan2(t.cross(this),t.dot(this))},Vt.equals=function(t){return this.x===t.x&&this.y===t.y},Vt.copy=function(t){return this.x=t.x,this.y=t.y,this},Vt.clone=function(){return new this.constructor(this.x,this.y)},Vt.toString=function(){return"Vector2 at "+this.x+" "+this.y};var Gt=J.prototype=Object.create(null);Gt.constructor=J,Gt.pos=null,Gt.width=0,Gt.height=0,Gt.toString=function(){return"Screen["+this.width+", "+this.height+"] at "+this.pos.x+", "+this.pos.y};var Jt=$.prototype=Object.create(G.prototype);Jt.constructor=$,Jt.type="mouse",Jt.onScreen=!1,Jt.toString=function(){return"Cursor at "+this.x+", "+this.y};var $t=_.prototype=Object.create(q.prototype);$t.constructor=_,$t.add=function(t,e){return this.reOrder(t,e)},$t.toggle=function(t,e){return this.has(t)?this.remove(t):this.add(t,e)},$t.toString=function(){return"[object ClassList]"},K.IMG="Image",K.AUDIO="Audio";var _t=K.prototype=Object.create(z.prototype);_t.constructor=K,_t.status="pending",_t.loadQueue=null,_t.setPathList=null,_t.start=function(){var t;for(this.emit("start");t=this.setPathList.pop();)t();return 0===this.loadQueue.length?(this.status="complete",this.emit("complete")):this.status="processing",this},_t.clear=function(){return this.loadQueue=[],this.setPathList=[],this},_t.reset=function(){return this.status="pending",this.clear(),this.offAll(),this},_t.load=function(t,e,n){var r=this["load"+t];return"function"==typeof r?r.call(this,e,n,!0):null},_t.loadImage=function(t,e,n){var r=this,i=new Image,s=function(s){var o=new st(s.type,i);o.originalEvent=s,o.data.type=K.IMG,o.data.src=t,r.remove(i),n||r.emit(s.type,o),"function"==typeof e&&e.call(i,s)};return i.addEventListener("load",s),i.addEventListener("error",s),n===!0&&(i.src=t),i},_t.loadAudio=function(t,e,n){var r=this,i=new Audio,s=function(s){var o=new st(s.type,i);o.originalEvent=s,o.data.type=K.AUDIO,o.data.src=t,r.remove(i),n||r.emit(s.type,o),"function"==typeof e&&e.call(i,s)};return i.addEventListener("canplaythrough",s),i.addEventListener("error",s),n&&(i.src=t),i},_t.add=function(t,e){var n=this["add"+t];return"function"==typeof n?n.call(this,e):null},_t.addImage=function(t){var e=this.loadImage(t,null,!1);return this.setPathList.push(function(){e.src=t}),this.loadQueue.push(e),e},_t.addAudio=function(t){var e=this.loadAudio(t,null,!1);return this.setPathList.push(function(){e.src=t}),this.loadQueue.push(e),e},_t.remove=function(t){var e,n=this.loadQueue.indexOf(t);return-1!==n?(e=this.loadQueue.splice(n,1)[0],0===this.loadQueue.length&&this.emit("complete"),e):null};var Kt=Z.prototype=Object.create(null);Kt.constructor=Z,Kt.add=function(t,e){return this.taskList.push(t),e!==!1&&t.reset(),this},Kt.remove=function(t){var e=this.taskList.indexOf(t);return-1!==e&&this.taskList.splice(e,1),this},Kt.clear=function(){for(var t=this.taskList;t.length;)t.pop();return this},Kt.restoreTask=function(t){return this.remove(t).add(t,!0),this},Kt.each=function(t){return this.taskList.forEach(t,this),this},Kt.perform=function(){return this.each(function(t){t.execute()===!0&&this.remove(t)}),this},Kt.toString=function(){return"[object Queue]"};var Zt=tt.prototype=Object.create(null);Zt.constructor=tt,Zt.execute=function(){var t=new Date;return t-this.lastTime>=this.interval?(this.lastTime=t,this.listener.call(this.thisArg,this.tick++,t-this.startTime,this)):!1},Zt.reset=function(){var t=new Date;return this.startTime=t,this.lastTime=t,this.tick=0,this},Zt.toString=function(){return"[object Task]"};var te=et.prototype=Object.create(null);te.constructor=et,te.items=null,te.count=function(){return this.keys().length},te.set=function(t,e){return this.items[t]=e,this},te.setSafe=function(t,e){return this.has(t)||(this.items[t]=e),this},te.get=function(t){return this.has(t)?this.items[t]:null},te.has=function(t){return t in this.items},te.remove=function(t){return delete this.items[t],this},te.clear=function(){return this.items=Object.create(null),this},te.each=function(t,e){var n,r=0;for(n in this.items)t.call(e,n,this.items[n],r++);return this},te.keys=function(){var t,e=[];for(t in this.items)e.push(t);return e},te.values=function(){var t,e=[];for(t in this.items)e.push(this.items[t]);return e},te.all=function(){var t,e={};for(t in this.items)e[t]=this.items[t];return e};var ee=nt.prototype=Object.create(D.prototype);ee.constructor=nt,ee.x=0,ee.y=0,ee.button=null;var ne=rt.prototype=Object.create(D.prototype);ne.constructor=rt,ne.keyCode=null,ne.character=null;var re=it.prototype=Object.create(D.prototype);re.constructor=it,re.dragStartX=null,re.dragStartY=null,re.dragged=null;var ie=st.prototype=Object.create(D.prototype);ie.constructor=st;var se=ot.prototype=Object.create(D.prototype);se.constructor=ot,se.objectives=null;var oe=l();oe.ELEMENT_FLOWS=new H("none","horizontal","vertical");var ae=l();ae.types=l(),ae.addType=function(t,e,n,r){return this.types[t]=P(l(),{constructor:e,instantiatable:n!==!1,extendable:r!==!1}),this},ae.hasType=function(t){return t in this.types},ae.getType=function(t){return this.hasType(t)?this.types[t]:null},ae.getInstantiatable=function(t){var e=this.getType(t);return u(e)||e.instantiatable!==!0?null:e.constructor},ae.getExtendable=function(t){var e=this.getType(t);return u(e)||e.extendable!==!0?null:e.constructor},ae.removeType=function(t){return delete this.types[t],this};var he=d(et),ue=d(et);ue.fromPrototype=function(t,e){var r=l();return n(e)||(e=[]),B(t,function(n,s){var o=Object.getOwnPropertyDescriptor(t,n);return u(s)||i(o.get)||i(o.set)||i(s)||O(e,n)?void 0:void(r[n]=s)}),r};var ce=d(et),le=d(et),de=l();de.types=l(),de.loaders=[],de.getLoader=function(){for(var t,e=0,n=this.loaders.length;n>e;e++)if(t=this.loaders[e],"pending"===t.status)return t;return t=new K,this.loaders.push(t),t},de.addType=function(t){return this.hasType(t)||(t=this.types[t]=l(),t.sourceMap=l(),t.IDMap=l()),this},de.hasType=function(t){return!h(this.types[t])},de.getByID=function(t,e){return this.hasType(t)?this.types[t].IDMap[e]||null:null},de.getBySrc=function(t,e){return this.hasType(t)?this.types[t].sourceMap[e]||null:null},de.getAll=function(t){var e=[];return this.hasType(t)&&(B(this.types[t].sourceMap,function(t,n){k(e,n)}),B(this.types[t].IDMap,function(t,n){k(e,n)})),e},de.clear=function(){return this.types=l(),this},de.addItem=function(t,e,n,r){var i=this.addType(t).types[t];return i.sourceMap[n]=e,h(r)||(i.IDMap[r]=e),this},de.addType(K.IMG),de.addType(K.AUDIO);var fe=l();fe.DOMElement=F("canvas"),fe.ctx=fe.DOMElement.getContext("2d");var pe=at.prototype=Object.create(z.prototype);pe.constructor=at;var me=function(){function t(t,e,n){this.key=t,this.edit(e,n),this.initialValue=this.value,this.value="inherit"}var e=t.prototype=l();return e.constructor=t,e.edit=function(t,e){var n=Yt(t);return this.primitiveValue=t,this.value=u(n)?t:n,this.type=i(this.value)?"method":"property",r(e)&&(this.inheritable=e),this},function(){var e=l();return this.addProp=function(n,s,o){return r(o)||(o=!0),this.hasProp(n)&&b(this.toString()+" already has property "+n),e[n]=new t(n,s,o),Object.defineProperty(this,n,{configurable:!0,enumerable:!1,get:function(){var t=e[n].value;return"inherit"===t&&(t=this.classList.execute(function(t){var r=ue.get(t);return u(r)||h(r[n])||"inherit"===r[n]?void 0:"initial"===r[n]?e[n].initialValue:r[n]},this)),i(t)?t.call(this):t},set:function(t){return e[n].edit(t).value}}),this},this.addPropSafe=function(t,e,n){return this.hasProp(t)||this.addProp(t,e,n),this},this.hasProp=function(t){return X(e,t)},this.removeProp=function(t){return X(e,t)&&(delete e[t],delete this[t]),this},this.setProp=function(t,n,r){return X(e,t)&&e[t].edit(n,r),this},this.getProp=function(t){return e[t]||null},this.getProps=function(t){var n=[];return B(e,function(e,r){return(h(t)||t.call(this,e,r)===!0)&&n.push(r),!1},this),n},this}}();pe.elementType="Element",pe.elementName="Element",pe.id=null,pe.uuid=null,Object.defineProperty(pe,"className",{get:function(){return this.classList.all().join(" ")}}),pe.parentLayer=null,pe.parentElement=null,pe.classList=null,pe.velocity=null,Object.defineProperty(pe,"vX",{get:function(){return this.velocity.x},set:function(t){return this.velocity.setX(t).x}}),Object.defineProperty(pe,"vY",{get:function(){return this.velocity.y},set:function(t){return this.velocity.setY(t).y}}),pe.x=0,pe.y=0,pe.maxX="none",pe.maxY="none",pe.minX="none",pe.minY="none",pe.offsetX=0,pe.offsetY=0,pe.width=0,pe.height=0,pe.maxWidth="none",pe.maxHeight="none",pe.minWidth="none",pe.minHeight="none",pe.top=0,pe.right=0,pe.bottom=0,pe.left=0,pe.screenX=0,pe.screenY=0,pe.parentX=0,pe.parentY=0,pe.renderWidth=0,pe.renderHeight=0,Object.defineProperties(pe,{screenXC:{get:function(){return this.screenX+this.renderWidth/2}},screenYC:{get:function(){return this.screenY+this.renderHeight/2}},screenXE:{get:function(){return this.screenX+this.renderWidth}},screenYE:{get:function(){return this.screenY+this.renderHeight}},parentXC:{get:function(){return this.parentX+this.renderWidth/2}},parentYC:{get:function(){return this.parentY+this.renderHeight/2}},parentXE:{get:function(){return this.parentX+this.renderWidth}},parentYE:{get:function(){return this.parentY+this.renderHeight}}}),pe.scaleX=1,pe.scaleY=1,pe.angle=0,pe.flipX=!1,pe.flipY=!1,pe.flow="none",pe.wrap=!0,pe.dragState=!1,pe.onFocus=!1,pe.isBlock=!0,pe.cursor="default",pe.allowDrop=!1,pe.title="",pe.opacity=1,pe.background="",pe.mask="",pe.horizontalAlign="left",pe.verticalAlign="top",pe.marginTop=0,pe.marginRight=0,pe.marginBottom=0,pe.marginLeft=0,Object.defineProperty(pe,"margin",{get:function(){return this.marginTop+" "+this.marginRight+" "+this.marginBottom+" "+this.marginLeft},set:function(t){var e=t.split(" "),n=e.length;
return 1===n?(this.marginTop=e[0],this.marginRight=e[0],this.marginBottom=e[0],this.marginLeft=e[0]):2===n?(this.marginTop=e[0],this.marginRight=e[1],this.marginBottom=e[0],this.marginLeft=e[1]):3===n?(this.marginTop=e[0],this.marginRight=e[1],this.marginBottom=e[2],this.marginLeft=e[1]):(this.marginTop=e[0],this.marginRight=e[1],this.marginBottom=e[2],this.marginLeft=e[3]),this.margin}}),pe.paddingTop=0,pe.paddingRight=0,pe.paddingBottom=0,pe.paddingLeft=0,Object.defineProperty(pe,"padding",{get:function(){return this.paddingTop+" "+this.paddingRight+" "+this.paddingBottom+" "+this.paddingLeft},set:function(t){var e=t.split(" "),n=e.length;return 1===n?(this.paddingTop=e[0],this.paddingRight=e[0],this.paddingBottom=e[0],this.paddingLeft=e[0]):2===n?(this.paddingTop=e[0],this.paddingRight=e[1],this.paddingBottom=e[0],this.paddingLeft=e[1]):3===n?(this.paddingTop=e[0],this.paddingRight=e[1],this.paddingBottom=e[2],this.paddingLeft=e[1]):(this.paddingTop=e[0],this.paddingRight=e[1],this.paddingBottom=e[2],this.paddingLeft=e[3]),this.padding}}),Object.defineProperty(pe,"border",{get:void 0,set:function(t){var e=t.split(" "),n=e.length;return n>=1&&(this.borderTopWidth=e[0],this.borderRightWidth=e[0],this.borderBottomWidth=e[0],this.borderLeftWidth=e[0]),n>=2&&(this.borderTopStyle=e[1],this.borderRightStyle=e[1],this.borderBottomStyle=e[1],this.borderLeftStyle=e[1]),3===n&&(this.borderTopColor=e[2],this.borderRightColor=e[2],this.borderBottomColor=e[2],this.borderLeftColor=e[2]),t}}),Object.defineProperty(pe,"borderTop",{get:void 0,set:function(t){var e=t.split(" "),n=e.length;return n>=1&&(this.borderTopWidth=e[0]),n>=2&&(this.borderTopStyle=e[1]),3===n&&(this.borderTopColor=e[2]),t}}),Object.defineProperty(pe,"borderRight",{get:void 0,set:function(t){var e=t.split(" "),n=e.length;return n>=1&&(this.borderTopWidth=e[0]),n>=2&&(this.borderTopStyle=e[1]),3===n&&(this.borderTopColor=e[2]),t}}),Object.defineProperty(pe,"borderBottom",{get:void 0,set:function(t){var e=t.split(" "),n=e.length;return n>=1&&(this.borderTopWidth=e[0]),n>=2&&(this.borderTopStyle=e[1]),3===n&&(this.borderTopColor=e[2]),t}}),Object.defineProperty(pe,"borderLeft",{get:void 0,set:function(t){var e=t.split(" "),n=e.length;return n>=1&&(this.borderTopWidth=e[0]),n>=2&&(this.borderTopStyle=e[1]),3===n&&(this.borderTopColor=e[2]),t}}),pe.borderTopWidth=0,pe.borderRightWidth=0,pe.borderBottomWidth=0,pe.borderLeftWidth=0,Object.defineProperty(pe,"borderWidth",{get:function(){return this.borderTopWidth+" "+this.borderRightWidth+" "+this.borderBottomWidth+" "+this.borderLeftWidth},set:function(t){var e=t.split(" "),n=e.length;return 1===n?(this.borderTopWidth=e[0],this.borderRightWidth=e[0],this.borderBottomWidth=e[0],this.borderLeftWidth=e[0]):2===n?(this.borderTopWidth=e[0],this.borderRightWidth=e[1],this.borderBottomWidth=e[0],this.borderLeftWidth=e[1]):3===n?(this.borderTopWidth=e[0],this.borderRightWidth=e[1],this.borderBottomWidth=e[2],this.borderLeftWidth=e[1]):(this.borderTopWidth=e[0],this.borderRightWidth=e[1],this.borderBottomWidth=e[2],this.borderLeftWidth=e[3]),this.borderWidth}}),pe.borderTopStyle="none",pe.borderRightStyle="none",pe.borderBottomStyle="none",pe.borderLeftStyle="none",Object.defineProperty(pe,"borderStyle",{get:function(){return this.borderTopStyle+" "+this.borderRightStyle+" "+this.borderBottomStyle+" "+this.borderLeftStyle},set:function(t){var e=t.split(" "),n=e.length;return 1===n?(this.borderTopStyle=e[0],this.borderRightStyle=e[0],this.borderBottomStyle=e[0],this.borderLeftStyle=e[0]):2===n?(this.borderTopStyle=e[0],this.borderRightStyle=e[1],this.borderBottomStyle=e[0],this.borderLeftStyle=e[1]):3===n?(this.borderTopStyle=e[0],this.borderRightStyle=e[1],this.borderBottomStyle=e[2],this.borderLeftStyle=e[1]):(this.borderTopStyle=e[0],this.borderRightStyle=e[1],this.borderBottomStyle=e[2],this.borderLeftStyle=e[3]),this.borderStyle}}),pe.borderTopColor="none",pe.borderRightColor="none",pe.borderBottomColor="none",pe.borderLeftColor="none",Object.defineProperty(pe,"borderColor",{get:function(){return this.borderTopColor+" "+this.borderRightColor+" "+this.borderBottomColor+" "+this.borderLeftColor},set:function(t){var e=t.split(" "),n=e.length;return 1===n?(this.borderTopColor=e[0],this.borderRightColor=e[0],this.borderBottomColor=e[0],this.borderLeftColor=e[0]):2===n?(this.borderTopColor=e[0],this.borderRightColor=e[1],this.borderBottomColor=e[0],this.borderLeftColor=e[1]):3===n?(this.borderTopColor=e[0],this.borderRightColor=e[1],this.borderBottomColor=e[2],this.borderLeftColor=e[1]):(this.borderTopColor=e[0],this.borderRightColor=e[1],this.borderBottomColor=e[2],this.borderLeftColor=e[3]),this.borderColor}}),pe.draggable=!1,pe.mousemove=function(t){return o(t)&&(t=Yt(t)),i(t)&&this.addEventListener("mousemove",t),this},pe.mouseenter=function(t){return o(t)&&(t=Yt(t)),i(t)&&this.addEventListener("mouseenter",t),this},pe.mouseleave=function(t){return o(t)&&(t=Yt(t)),i(t)&&this.addEventListener("mouseleave",t),this},pe.mousedown=function(t){return o(t)&&(t=Yt(t)),i(t)&&this.addEventListener("mousedown",t),this},pe.mouseup=function(t){return o(t)&&(t=Yt(t)),i(t)&&this.addEventListener("mouseup",t),this},pe.edit=function(t){return Bt(this,t)},pe.getScene=function(){var t=this.parentLayer;return c(t,ht)&&c(t.root,ct)?t.root:null},pe.isChildOf=function(t){var e=t;do{if(this.parentElement===e)return!0;e=e.parentElement}while(c(e,gt));return!1},pe.scale=function(t,e){return this.scaleX=t,this.scaleY=e,this},pe.addClass=function(t,e){return this.classList.add(t,e),this},pe.toggleClass=function(t,e){return this.classList.toggle(t,e),this},pe.removeClass=function(t){return this.classList.remove(t),this},pe.toggle=function(t){return r(this[t])&&(this[t]=!this[t]),this},pe.applyTransform=function(t){var e,n,r=a(this.angle)?g(this.angle%360):0,i=a(this.scaleX)?this.scaleX:1,s=a(this.scaleY)?this.scaleY:1;return this.flipX===!0&&(i*=-1),this.flipY===!0&&(s*=-1),(0!==r||1!==i||1!==s)&&(e=this.screenX+this.renderWidth/2,n=this.screenY+this.renderHeight/2,t.translate(e,n),0!==r&&t.rotate(r),(1!==i||1!==s)&&t.scale(i,s),t.translate(-e,-n)),this},pe.applyMask=function(t){var e=ce.get(this.mask);return u(e)||(t.beginPath(),e(t,this),t.clip()),this},pe.drawBox=function(t){var e=this.screenX,n=this.screenY,r=this.renderWidth,i=this.renderHeight;return""!==this.background&&(t.fillStyle=this.background,t.fillRect(e,n,r,i)),this.borderTopWidth>0&&(t.beginPath(),t.lineWidth=this.borderTopWidth,t.strokeStyle=this.borderTopColor,t.moveTo(e,n),t.lineTo(e+r,n),t.stroke()),this.borderRightWidth>0&&(t.beginPath(),t.lineWidth=this.borderRightWidth,t.strokeStyle=this.borderRightColor,t.moveTo(e+r,n),t.lineTo(e+r,n+i),t.stroke()),this.borderBottomWidth>0&&(t.beginPath(),t.lineWidth=this.borderBottomWidth,t.strokeStyle=this.borderBottomColor,t.moveTo(e+r,n+i),t.lineTo(e,n+i),t.stroke()),this.borderLeftWidth>0&&(t.beginPath(),t.lineWidth=this.borderLeftWidth,t.strokeStyle=this.borderLeftColor,t.moveTo(e,n+i),t.lineTo(e,n),t.stroke()),this},pe.update=function(){return a(this.x)&&a(this.vX)&&(this.x+=this.vX,a(this.minX)&&a(this.maxX)&&(this.x<=this.minX?this.x=this.maxX:this.x>=this.maxX&&(this.x=this.minX))),a(this.y)&&a(this.vY)&&(this.y+=this.vY,a(this.minY)&&a(this.maxY)&&(this.y<=this.minY?this.y=this.maxY:this.y>=this.maxY&&(this.y=this.minY))),this},pe.animation=function(t,e,n){var r=I(this,R(t)),i=function(n,i,s){var o=y(0,1,i/(e||0));return B(r,function(e,n){this[e]=r[e]+(t[e]-r[e])*o},this),1===o};return new tt(i,n,this)},pe.animate=function(t,e,n){var r=this.getScene(),i=null;return c(r,ct)&&(i=this.animation(t,e,n),r.queue.add(i,!0)),i},pe.clone=function(){var t,e,n=ae.getInstantiatable(this.elementName),r=null;return u(n)||(t=l(),e=this.getProps(),C(e,function(e){"inherit"!==e.value&&(t[e.key]=e.value)}),r=new n(t)),r},pe.toString=function(){return"Chill Element["+this.elementType+"]"};var ye=ue.fromPrototype(pe,["elementType","elementName","top","right","bottom","left","screenX","screenY","parentX","parentY","renderWidth","renderHeight","onFocus","dragState"]);ae.addType(pe.elementName,at,!1,!0),ue.set(pe.elementType,ye);var ge=ht.prototype=Object.create(z.prototype);ge.constructor=ht,ge.root=null,ge.id=null,ge.uuid=null,ge.canvas=null,ge.ctx=null,Object.defineProperty(ge,"x",{get:function(){return m(this.canvas.style.left)||0},set:function(t){return this.canvas.style.left=t+"px"}}),Object.defineProperty(ge,"y",{get:function(){return m(this.canvas.style.top)||0},set:function(t){return this.canvas.style.top=t+"px"}}),Object.defineProperty(ge,"width",{get:function(){return this.canvas.width},set:function(t){return this.canvas.width=t}}),Object.defineProperty(ge,"height",{get:function(){return this.canvas.height},set:function(t){return this.canvas.height=t}}),Object.defineProperty(ge,"zIndex",{get:function(){return+this.canvas.style.zIndex},set:function(t){return+(this.canvas.style.zIndex=t)}}),Object.defineProperty(ge,"background",{get:function(){return this.canvas.style.background},set:function(t){return this.canvas.style.background=t}}),Object.defineProperty(ge,"opacity",{get:function(){return this.ctx.globalAlpha},set:function(t){return this.ctx.globalAlpha=t}}),ge.live=!0,ge.visible=!0,ge.render=function(){function t(t){var e=this.ctx;e.save(),t.applyTransform(e),t.applyMask(e),t.drawBox(e),t.draw(e),e.restore()}return function(){return this.visible===!0&&(this.clear(),this.eachElement(t,this)),this}}(),ge.clear=function(){return this.ctx.clearRect(0,0,this.width,this.height),this},ge.getPixel=function(t,e){return this.ctx.getImageData(t,e,1,1).data},ge.scrollTo=function(t,e){return this.x=t,this.y=e,this},ge.scrollBy=function(t,e){return this.x+=t,this.y+=e,this},ge.toString=function(){return"Chill Layer"};var ve=ct.prototype=Object.create(z.prototype);ve.constructor=ct,ve.uuid=null,ve.wrapper=null,ve.screen=null,ve.cursor=null,ve.readyState=null,ve.settings=null,ve.loader=null,ve.queue=null,ve.run=!1,ve.lastTick=0,ve.tickCount=0,ve.fps=0,ve.include=function(t,e){var n=this;return o(t)?Ft.getJSON(t,function(t){Bt(n,t),i(e)&&e(n)}):(s(t)&&Bt(n,t),i(e)&&e(n)),n},ve.preload=function(t,e){var n=this,r=de.getLoader(),i=function(){n.emit("preloadComplete"),r.reset()};return r.on("complete",i),B(e,function(e,n){n=j(n),C(n,function(n){var i=n.split(" as "),s=i[0].replace(/^@/,t),o=i[1],a=r.add(e,s,o);u(a)||de.addItem(e,a,s,o)},this)},this),r.start(),this},ve.playAudio=function(t,e,n,r){return o(t)&&w(t,"#")&&(t=de.getByID(K.AUDIO,t.slice(1))),c(t,Audio)&&(h(e)&&(e=this.settings.get("volume")),M(t,e,n,r)),this},ve.resize=function(t,e){return this.setWidth(t),this.setHeight(e),this},ve.setWidth=function(t){return this.screen.width=t,this.wrapper.style.width=t+"px",this},ve.setHeight=function(t){return this.screen.height=t,this.wrapper.style.height=t+"px",this},ve.addTask=function(t,e,n){var r=new tt(t,e,n);return this.queue.add(r),r},ve.removeTask=function(t){return this.queue.remove(t)},ve.later=function(t,e,n){return this.queue.add(new tt(function(){return t.apply(this,f(arguments)),!0},e,n))},ve.repeat=function(t,e,n,r){var i=0;return this.queue.add(new tt(function(){return t.apply(this,f(arguments)),++i>=e},n,r))},ve.onScreen=function(t,e){var n=this.screen.pos.x,r=this.screen.pos.y,i=n+this.screen.width,s=r+this.screen.height;return e===!1?t.screenX>=n&&t.screenY>=r&&t.screenXE<=i&&t.screenYE<=s:!(n>t.screenXE||i<t.screenX||r>t.screenYE||s<t.screenY)},ve.addPlugin=function(t,e){var n,r=le.get(t);return u(r)?b('cannot add plugin "'+t+'", plugin does not exists'):t in this?b('cannot add plugin "'+t+'", already exists in scene'):(n=Object.create(r.config),s(e)&&P(n,e),this[t]=r.constructor.call(this,n),this[t].config=n),this},ve.createAbstractElement=function(t,e,n,r){return he.set(t,new yt(e,n,r)),this},ve.update=function(){function t(t){t.update()}return function(){return this.eachElement(t),this}}(),ve.reflow=function(){function t(t){n(t.body,0,0,t.width,t.height,0,0,0,0)}function n(t,e,s,o,h,u,l,d,f){var p,m,g,v,b,x,T,w,L=t.minWidth,E=t.minHeight,S=t.maxWidth,O=t.maxHeight,k=r(t.marginTop,h),j=r(t.marginRight,o),C=r(t.marginBottom,h),W=r(t.marginLeft,o),A=t.width,P=t.height,X=t.flow;switch("horizontal"===X?(b=d,x=u):"vertical"===X?(b=l,x=f):(b=r(t.x,o),x=r(t.y,h)),b+=W,x+=k,A){case"fit":A=o-(b-e);break;case"auto":A=i(t.measureWidth)?t.measureWidth():0;break;default:A=r(A,o)}switch(P){case"fit":P=h-(x-s);break;case"auto":P=i(t.measureHeight)?t.measureHeight():0;break;default:P=r(P,h)}if("none"!==L&&(A=Math.max(A,r(L,o))),"none"!==S&&(A=Math.min(A,r(S,o))),"none"!==E&&(P=Math.max(P,r(E,o))),"none"!==O&&(P=Math.min(P,r(O,o))),"vertical"===X)switch(t.horizontalAlign){case"center":b=l+d/2-A/2;break;case"right":b=d-A}if(m=b,g=b+A+j,"horizontal"===X)switch(t.verticalAlign){case"middle":x=u+f/2-P/2;break;case"bottom":x=f-P}return p=x,v=x+P+C,t.wrap===!0&&("horizontal"===X?g>e+o&&(b=e+W,x=f+k,p=x,g=b+A+j,v=x+P+C,m=b):"vertical"===X&&v>s+h&&(b=d+W,x=s+k,p=x,g=b+A+j,v=x+P+C,m=b)),c(t,gt)&&(v=p,g=m,t.each(function(t){var r=n(t,b,x,A,P,p,m,g,v);("horizontal"===r.flow||"vertical"===r.flow)&&(p=y(s,p,r.top),g=Math.max(g,r.right),v=Math.max(v,r.bottom),m=y(e,m,r.left))},null,!1)),t.top=p,t.right=g,t.bottom=v,t.left=m,T=r(t.offsetX,A),w=r(t.offsetY,P),a(T)&&(b+=T),a(w)&&(x+=w),t.screenX=b,t.screenY=x,t.parentX=b-e,t.parentY=x-s,t.renderWidth=A,t.renderHeight=P,t}function r(t,n){var r;if(a(t))return t;if(t=String(t),!a(n))return 0;switch(t){case"left":return 0;case"center":return n/2;case"right":return n;case"stick left":return n;case"stick center":return 1.5*n;case"stick right":return 2*n}return r=e(At,t),u(r)?0:(r=Number(r),w(t,"stick")?L(t,"%")?n+n*r/100:n+r:L(t,"%")?r*n/100:r)}return function(){return this.eachLayer(t),this}}(),ve.paint=function(){function t(t){t.live&&t.render()}return function(){return this.eachLayer(t),this}}(),ve.toString=function(){return"Chill Scene"};var be=yt.prototype=l();be.constructor=yt,be.elementType="AbstractElement",be.elementName="Abstract",be.type=null,be.use=null,be.args=null,be.instantiate=function(){var t=ae.getInstantiatable(this.type),e=null;return u(t)||(e=new(Function.prototype.bind.apply(t,this.args)),e.edit(this.use)),e},ae.addType(be.elementName,yt,!1,!1);var xe=gt.prototype=Object.create(at.prototype);xe.constructor=gt,xe.elementType="ContainerElement",xe.elementName="Container",xe.draw=function(t){var e=this.background;return o(e)&&e.length>0&&(t.beginPath(),t.fillStyle=e,t.fillRect(this.screenX,this.screenY,this.renderWidth,this.renderHeight)),this};var Te=l();Te.width="fit",Te.height="fit",ae.addType(xe.elementName,gt,!0,!0),ue.set(xe.elementType,Te);var we=bt.prototype=Object.create(at.prototype);we.constructor=bt,we.elementType="PolygonElement",we.elementName="Polygon",we.vertices=null,we.fill="",we.strokeWidth=1,we.strokeColor="#000000",we.draw=function(t){var e=this.vertices,n=0,r=e.length,i=this.screenX,s=this.screenY,o=this.renderWidth,a=this.renderHeight;if(r>0){for(t.beginPath(),t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.moveTo(i+e[n][0]*o,s+e[n][1]*a),++n;r>n;n++)t.lineTo(i+e[n][0]*o,s+e[n][1]*a);r>2&&(t.closePath(),this.fill&&(t.fillStyle=this.fill,t.fill())),t.stroke()}return this};var Le=ue.fromPrototype(we,["elementType","elementName"]);ae.addType(we.elementName,bt,!1,!0),ue.set(we.elementType,Le);var Ee=xt.prototype=Object.create(bt.prototype);Ee.constructor=xt,Ee.elementType="LineElement",Ee.elementName="Line",ae.addType(Ee.elementName,xt,!0,!0);var Se=Tt.prototype=Object.create(bt.prototype);Se.constructor=Tt,Se.elementType="TriangleElement",Se.elementName="Triangle",ae.addType(Se.elementName,Tt,!0,!0);var Oe=wt.prototype=Object.create(bt.prototype);Oe.constructor=wt,Oe.elementType="RectangleElement",Oe.elementName="Rectangle",ae.addType(Oe.elementName,wt,!0,!0);var ke=Lt.prototype=Object.create(bt.prototype);ke.constructor=Lt,ke.elementType="PentagonElement",ke.elementName="Pentagon",ae.addType(ke.elementName,Lt,!0,!0);var je=Et.prototype=Object.create(bt.prototype);je.constructor=Et,je.elementType="HexagonElement",je.elementName="Hexagon",ae.addType(je.elementName,Et,!0,!0);var Ce=St.prototype=Object.create(bt.prototype);Ce.constructor=St,Ce.elementType="StarElement",Ce.elementName="Star",ae.addType(Ce.elementName,St,!0,!0);var We=Ot.prototype=Object.create(at.prototype);We.constructor=Ot,We.elementType="CircleElement",We.elementName="Circle",We.r=10,We.fill="",We.strokeWidth=1,We.strokeColor="#000000",We.measureWidth=function(){return 2*this.r},We.measureHeight=function(){return 2*this.r},We.draw=function(t){return t.beginPath(),t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.arc(this.screenX+this.r,this.screenY+this.r,this.r,0,2*Math.PI,!0),t.stroke(),""!==this.fill&&(t.fillStyle=this.fill,t.fill()),this};var Ae=ue.fromPrototype(We,["elementType","elementName"]);Ae.width="auto",Ae.height="auto",ae.addType(We.elementName,Ot,!0,!0),ue.set(We.elementType,Ae);var Pe=kt.prototype=Object.create(at.prototype);Pe.constructor=kt,Pe.elementType="EllipseElement",Pe.elementName="Ellipse",Pe.fill="",Pe.strokeWidth=1,Pe.strokeColor="#000000",Pe.draw=function(t){var e=.5522848,n=this.renderWidth/2,r=this.renderHeight/2,i=this.screenX,s=this.screenY,o=n*e,a=r*e,h=i+n,u=s+r,c=h+n,l=u+r;return t.beginPath(),t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.moveTo(i,u),t.bezierCurveTo(i,u-a,h-o,s,h,s),t.bezierCurveTo(h+o,s,c,u-a,c,u),t.bezierCurveTo(c,u+a,h+o,l,h,l),t.bezierCurveTo(h-o,l,i,u+a,i,u),t.stroke(),""!==this.fill&&(t.fillStyle=this.fill,t.fill()),this};var Xe=ue.fromPrototype(Pe,["elementType","elementName"]);ae.addType(Pe.elementName,kt,!0,!0),ue.set(Pe.elementType,Xe);var Ye=jt.prototype=Object.create(at.prototype);Ye.constructor=jt,Ye.elementType="TextElement",Ye.elementName="Text",Ye.text=null,Ye.textColor="#000000",Ye.textIndent=0,Ye.textDecoration="none",Ye.textTransform="none",Ye.textShadow="none",Ye.fontFamily="sans-serif",Ye.fontSize=12,Ye.fontWeight="normal",Ye.fontStyle="normal",Ye.letterSpacing=0,Ye.textAlign="left",Ye.textBaseline="top",Ye.lineHeight="auto",Ye.measureWidth=function(){var t,e=fe.ctx,n=0,r=this.getLines(),i=0,s=r.length;for(e.font=this.getFontDescriptor();s>i;i++)t=e.measureText(r[i]).width,t>n&&(n=t);return n},Ye.measureHeight=function(){return this.getLines().length*this.getLineHeight()},Ye.draw=function(t){var e=this.getLines(),n=1,r=e.length,i=this.getLineHeight(),s=this.screenX,o=this.screenY+(i-this.fontSize)/2,a=this.textAlign;for(t.beginPath(),t.font=this.getFontDescriptor(),t.textAlign=a,t.textBaseline="top",t.fillStyle=this.textColor,"center"===a&&(s+=this.renderWidth/2),"right"===a&&(s+=this.renderWidth),t.fillText(e[0],s+this.textIndent,o);r>n;n++)t.fillText(e[n],s,o+=i);return this},Ye.getFontDescriptor=function(){var t="";return"bold"===this.fontWeight&&(t+="bold "),"italic"===this.fontStyle&&(t+="italic "),t+=this.fontSize+"px ",t+=this.fontFamily},Ye.getTransformedText=function(){var t=String(this.text);switch(this.textTransform){case"lowercase":t=t.toLowerCase();break;case"uppercase":t=t.toUpperCase();break;case"capitalize":t=It(t)}return this.letterSpacing>0&&(t=t.split("").join(v(" ",this.letterSpacing))),t},Ye.getLineHeight=function(){var t=this.lineHeight;return"auto"===t?this.fontSize:p(t)?Rt(t,this.fontSize):a(m(t))?m(t):0},Ye.getLines=function(){return this.getTransformedText().split(Pt)};var Re=ue.fromPrototype(Ye,["elementType","elementName"]);Re.width="auto",Re.height="auto",ae.addType(Ye.elementName,jt,!0,!0),ue.set(Ye.elementType,Re);var Be=Ct.prototype=Object.create(at.prototype);Be.constructor=Ct,Be.elementType="ImageElement",Be.elementName="Image",Be.sourceX=0,Be.sourceY=0,Be.sourceWidth="100%",Be.sourceHeight="100%",Be.img=null,Object.defineProperty(Be,"src",{get:function(){return this.img.src},set:function(t){return w(t,"#")&&(t=de.getByID(K.IMG,t.slice(1)).src),this.img.src=t}}),Be.measureWidth=function(){var t=this.sourceWidth;return a(t)?t:p(t)?Rt(t,img.width):this.img.width},Be.measureHeight=function(){var t=this.sourceHeight;return a(t)?t:p(t)?Rt(t,img.height):this.img.height},Be.draw=function(t){var e,n,r=this.img;return r.complete===!0&&(p(e=this.sourceX)&&(e=Rt(e,r.width)),p(n=this.sourceY)&&(n=Rt(n,r.height)),t.drawImage(r,e,n,this.measureWidth(),this.measureHeight(),this.screenX,this.screenY,this.renderWidth,this.renderHeight)),this};var Ie=ue.fromPrototype(Be,["elementType","elementName"]);Ie.width="auto",Ie.height="auto",ae.addType(Be.elementName,Ct,!0,!0),ue.set(Be.elementType,Ie);var Me=Wt.prototype=Object.create(at.prototype);Me.constructor=Wt,Me.elementType="SpriteSheetElement",Me.elementName="SpriteSheet",Me.sourceX=0,Me.sourceY=0,Me.frameWidth=0,Me.frameHeight=0,Me.img=null,Object.defineProperty(Me,"src",{get:function(){return this.img.src},set:function(t){return w(t,"#")&&(t=de.getByID(K.IMG,t.slice(1)).src),this.img.src=t}}),Me.animations=null,Me.frames=null,Me.tick=0,Me.currentAnimation="default",Me.currentFrame=0,Me.currentAnimationFrame=null,Me.frameRate=7,Me.frameSpacing=0,Me.paused=!1,Me.addAnimation=function(t,e){return this.animations[t]=l(),P(this.animations[t],{frames:[],next:t,frameRate:this.frameRate,direction:"forward"}),this.editAnimation(t,e)},Me.editAnimation=function(t,e){var r;return X(this.animations,t)&&(r=this.animations[t],n(e.frames)&&(S(r.frames),r.frames.push.apply(r.frames,e.frames)),o(e.next)&&(r.next=e.next),a(e.frameRate)&&(r.frameRate=e.frameRate),("forward"===e.direction||"backward"===e.direction)&&(r.direction=e.direction)),this},Me.removeAnimation=function(t){return delete this.animations[t],this},Me.setFrameSize=function(t,e,n,r){var i=0,s=0;return a(n)&&a(r)?(i=n,s=r):this.img.complete===!0&&(i=this.img.width,s=this.img.height),this.frameWidth=this.img.width/e-2*this.frameSpacing,this.frameHeight=this.img.height/t-2*this.frameSpacing,this.setFrames()},Me.setFrames=function(t){var e,n,r,i,s,o,h,u,c,l;if(this.img.complete===!0){e=0,a(t)||(t=1/0),S(this.frames),o=this.img.width,h=this.img.height,p(n=this.sourceX)&&(n=Rt(n,this.frameWidth)),p(r=this.sourceY)&&(r=Rt(r,this.frameHeight));t:for(s=r;h>s;s+=this.frameHeight)for(i=n;o>i;i+=this.frameWidth)if(this.frames.push({x:i,y:s}),++e>=t)break t}else u=this,c=f(arguments),l=function(){u.setFrames.apply(u,c),u.img.removeEventListener("load",l)},this.img.addEventListener("load",l);return this},Me.start=function(){return this.paused=!1,this},Me.stop=function(){return this.paused=!0,this},Me.measureWidth=function(){var t=this.frameWidth;return p(t)?Rt(t,this.img.width):t},Me.measureHeight=function(){var t=this.frameHeight;return p(t)?Rt(t,this.img.height):t},Me.draw=function(t){var e,n,r,i,s,o=this.img;return o.complete===!0&&(p(e=this.frameWidth)&&(e=Rt(e,o.width)),p(n=this.frameHeight)&&(n=Rt(n,o.height)),this.paused===!1&&X(this.animations,this.currentAnimation)&&(r=this.animations[this.currentAnimation],s=r.frames,i=a(r.frameRate)?r.frameRate:this.frameRate,++this.tick>=i&&s.length>0&&("backward"===r.direction?--this.currentFrame<=0&&(r.next===this.currentAnimation&&r.loop===!0?this.currentFrame=s.length-1:(X(this.animations,r.next)&&(this.currentAnimation=r.next),this.currentFrame=0)):++this.currentFrame>=s.length&&(r.next===this.currentAnimation&&r.loop===!0?this.currentFrame=0:(X(this.animations,r.next)&&(this.currentAnimation=r.next),this.currentFrame=0)),this.currentAnimationFrame=this.frames[s[this.currentFrame]],this.tick=0)),t.drawImage(o,this.currentAnimationFrame.x,this.currentAnimationFrame.y,e,n,this.screenX,this.screenY,this.renderWidth,this.renderHeight)),this};var Fe=l();Fe.width="auto",Fe.height="auto",Fe.frameRate=Me.frameRate,ae.addType(Me.elementName,Wt,!0,!0),ue.set(Me.elementType,Fe);var He=l();He.App=function(t){this.appData=t};var Ne=He.App.prototype=l();Ne.constructor=He.App,Ne.appData=null,Ne.toString=function(){return"Chill App"},He.Debugger=function(t){this.scene=t};var De=He.Debugger.prototype=l();De.constructor=He.Debugger,De.scene=null,De.addElements=function(t,e,n,r){return n=h(n)?"Text":n,T(e,function(e){var s=t.create(n);t.add(s),i(r)&&r(s,e)}),this.scene},He.out=function(t,e,n){var r;return o(e)&&(e=Mt.getElementById(e)),c(e,HTMLElement)||x("the given wrapper not an html element"),e.children.length>0&&b("wrapper should be empty"),e.classList.add("chill-wrapper"),r=new ct(e),t instanceof He.App||b("app not instance of Chill\\App"),r.include(t.appData,n),r},He.createClass=function(t,e){return ue.set(t,e),this},He.createMask=function(t,e){return i(e)&&ce.set(t,e),this},He.createAbstractElement=ve.createAbstractElement,He.createPlugin=function(t,e,n,r){var o,a,h=le.has(t);return h&&r!==!0?b('plugin "'+t+'" already exists'):i(e)?(o=l(),a=l(),s(n)&&P(a,n),o.constructor=e,o.config=a,le.set(t,o)):b("invalid plugin constructor type"),this},He.createElementType=function(t,e){var n,r,o;return i(e.constructor)?ae.hasType(t)?b('Cannot create "'+t+'", type already exists'):(n=ae.getExtendable(e["extends"]),u(n)&&(h(e["extends"])||b('Cannot extend "'+e["extends"]+'", type does not exists, fall back to default: Element'),n=at),r=Object.create(n.prototype),o=function(){var t=f(arguments);n.call(this,t),e.constructor.apply(this,t)},i(e.prototype)?e.prototype.call(r):s(e.prototype)&&P(r,e.prototype),o.prototype=r,o.prototype.constructor=o,ae.addType(t,o,e.instantiatable,e.extendable)):b("Constructor is required to create a new element type"),this},t.Chill=He}(this);