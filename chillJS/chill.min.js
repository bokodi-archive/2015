/**
 * chillJS - JavaScript 2D library
 * 
 * @version v0.0.1-alpha
 * @link http://bokodi.github.io/chillJS/
 * @license MIT
 * 
 * 
 * Date: Sat Jan 14 2017
 */
!function(t){"use strict";function e(t,e){var n=e.match(t);return null===n?null:n[0]}function n(t){return"[object Array]"===Object.prototype.toString.call(t)}function r(t){return"boolean"==typeof t}function i(t){return"function"==typeof t}function s(t){return"[object Object]"===Object.prototype.toString.call(t)}function o(t){return"string"==typeof t}function a(t){return"number"==typeof t}function h(t){return void 0===t}function c(t){return null===t}function u(t,e){return t instanceof e}function l(){return Object.create(null)}function d(t){var e=null;return"function"==typeof t&&(e=Object.create(t.prototype),t.call(e)),e}function f(t,e,n){return Array.prototype.slice.call(t,e,n)}function p(t){return"string"==typeof t&&"%"===t.slice(-1)}function m(e){return t.parseInt(e,10)}function y(t,e,n){return Math.max(t,Math.min(e,n))}function g(t){return t*Math.PI/180}function v(t,e){for(var n="";e-- >0;)n+=t;return n}function b(t){console.warn(t)}function x(t){throw new Error(t)}function T(t,e,n){for(var r=-1;++r<t;)e.call(n,r);return n}function w(t,e){return 0===t.indexOf(e)}function L(t,e){var n=t.lastIndexOf(e);return-1!==n&&n===t.length-e.length}function E(t,e,n){var r,i=0;for(void 0===n&&(n=1);-1!==(r=t.indexOf(e))&&(t.splice(r,1),!(++i>=n)););return i}function S(t){for(;t.length>0;)t.pop();return t}function O(t,e){return-1!==t.indexOf(e)}function j(t,e){return O(t,e)||t.push(e),t}function k(t){return"[object Array]"===Object.prototype.toString.call(t)?t:[t]}function C(t,e,n){for(var r=0,i=t.length;i>r&&e.call(n,t[r],r,t)!==!0;r++);return t}function W(t,e){for(var n=0,r=t.length;r>n&&e.call(t[n],n,t)!==!0;n++);return t}function P(t,e){for(var n=Array.prototype.slice.call(arguments,2),r=0,i=t.length;i>r;r++)e.apply(t[r],n);return t}function A(t){for(var e,n=Array.prototype.slice.call(arguments,1),r=0,i=n.length;i>r;r++)e=n[r],B(e,function(e,n){t[e]=n});return t}function X(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Y(t){for(var e,n=Array.prototype.slice.call(arguments,1),r=0,i=n.length;i>r;r++)e=n[r],B(e,function(e,n){X(t,e)||(t[e]=n)});return t}function R(t){var e=[];return B(t,function(t){e.push(t)}),e}function B(t,e,n){var r;for(r in t)if(X(t,r)&&e.call(n,r,t[r],t)===!0)break;return t}function I(t,e){for(var n,r={},i=0,s=e.length;s>i;i++)n=e[i],r[n]=t[n];return r}function H(t,e,n,r){var i;return t.readyState>0&&(n===!0&&(t.pause(),t.currentTime=0),"function"==typeof r&&(i=function(e){r.call(this,e),t.removeEventListener("ended",i)},t.addEventListener("ended",i)),void 0!==e&&(t.volume=Math.min(Math.max(0,e/100),1)),t.play()),t}function M(e,n,r){var i=t.document.createElement(e);return void 0!==n&&n.appendChild(i),void 0!==r&&(i.textContent=r),i}function N(){F.apply(this,Array.prototype.slice.call(arguments))}function F(){for(var t,e,n=0,r=arguments.length,i=Object.prototype.toString,s=Object.prototype.hasOwnProperty;r>n;n++)if(t=arguments[n],"string"==typeof t)this[t]=t;else if("[object Array]"===i.call(t))F.apply(this,t);else if("[object Object]"===i.call(t))for(e in t)s.call(t,e)&&(this[e]=t[e])}function D(t){this.type=t,this.data={},this.timeStamp=(new Date).getTime()}function z(){this.eventList={}}function q(){var t=Object.create(null),e=!0;this.count=0,this.add=function(n,r){return"number"==typeof r&&r===r|0&&isFinite(r)||(r=this.lastID()||0),void 0===t[r]&&(t[r]=[],e=!0),t[r].push(n),++this.count,this},this.addBefore=function(e,n){var r,i=this.getOrderOf(n);return null!==i&&(r=t[i].indexOf(n),-1!==r&&(t[i].splice(r,0,e),++this.count)),this},this.addAfter=function(e,n){var r,i=this.getOrderOf(n);return null!==i&&(r=t[i].indexOf(n),-1!==r&&(t[i].splice(r+1,0,e),++this.count)),this},this.remove=function(e){var n,r=this.getOrderOf(e),i=null;return null!==r&&(n=t[r].indexOf(e),-1!==n&&(i=t[r].splice(n,1)[0],--this.count)),i},this.has=function(t){return null!==this.getOrderOf(t)},this.reOrder=function(t,e){return this.remove(t).add(t,e)},this.clear=function(){return this.order={},this.count=0,e=!0,this},this.each=function(e,n){var r=0;return this.getOrders().forEach(function(i){t[i].forEach(function(t){e.call(n,t,r++)})}),this},this.execute=function(e,n){for(var r,i,s,o=this.getOrders(),a=0,h=o.length-1;h>=0;--h)for(i=t[o[h]],r=i.length-1;r>=0;--r)if(s=e.call(n,i[r],a++),void 0!==s)return s;return null},this.firstID=function(){var t=this.getOrders()[0];return void 0===t?null:t},this.lastID=function(){var t=this.getOrders().slice(-1)[0];return void 0===t?null:t},this.first=function(){var e=t[this.firstID()];return void 0!==e&&e.length>0?e[0]:null},this.last=function(){var e=t[this.lastID()];return void 0!==e&&e.length>0?e.slice(-1)[0]:null},this.getOrders=function(){function n(t,e){return t-e}var r=null;return function(){return e&&(r=Object.keys(t).sort(n),e=!1),r}}(),this.all=function(){var t=[];return this.each(function(e){t.push(e)}),t},this.getOrderOf=function(e){var n,r=null,i=Object.prototype.hasOwnProperty;for(n in t)if(i.call(t,n)&&-1!==t[n].indexOf(e)){r=n;break}return r}}function Q(){this.data={}}function U(){var t=Object.prototype.hasOwnProperty,e={};this.get=function(n){return t.call(e,n)?e[n]:null},this.set=function(t,n){return e[t]=n},this.edit=function(n){var r;for(r in n)t.call(n,r)&&(e[r]=n[r]);return this},this.getAll=function(){var n,r={};for(n in e)t.call(e,n)&&(r[n]=e[n]);return r}}function G(){var t=Object.prototype.hasOwnProperty,e={};this.get=function(n){return t.call(e,n)?e[n]:null},this.set=function(t,n){return e[t]=n}}function V(t,e){this.x=t||0,this.y=e||0}function J(){this.pos=new V}function $(t){V.call(this),this.type=t}function _(){q.call(this)}function K(t){z.call(this),t&&(this.basePath=t),this.reset()}function Z(){this.taskList=[]}function tt(t,e,n){this.listener=t,this.interval=e||0,this.thisArg=n||this,this.reset()}function et(){this.items=Object.create(null)}function nt(t,e,n,r){D.call(this,t),this.x=e,this.y=n,this.button=r}function rt(t,e){D.call(this,t),this.keyCode=e,this.character=String.fromCharCode(e).toLowerCase()}function it(t,e,n,r){D.call(this,t),this.dragStartX=e,this.dragStartY=n,this.dragged=Array.prototype.concat(r)}function st(t,e){D.call(this,t),this.target=e}function ot(t,e){D.call(this,t),this.objectives=Array.prototype.concat(e)}function at(){z.call(this),G.call(this),ge.call(this),this.uuid=Yt(),this.velocity=new V(0,0),this.classList=new _,this.classList.add(ye.elementType,0),B(ve,this.addProp,this)}function ht(t){z.call(this),ct.call(this),this.uuid=Yt(),this.canvas=M("canvas"),this.ctx=this.canvas.getContext("2d"),It(this,t)}function ct(){function t(t){return t.parentLayer===e&&u(t.parentElement,gt)&&e.contains(t)}var e=this,r=l(),i=new gt("body");return this.body=r.body=i,this.add=function(t,e,n){if(u(t,at)){if(u(t,gt)){if(X(r,t.id))return b("unable to add container#"+t.id+', "'+t.id+'" already exists in layer#'+this.id),this;r[t.id]=t}X(r,e)||(h(e)||b('"'+e+'" does not exists in layer#'+this.id+", use #body by default"),e="body"),r[e].add(t,n),t.parentLayer=this,t.parentElement=r[e]}else b("only elements can be added to layer#"+this.id);return this},this.getElementByID=function(t){var e=null;return this.eachElement(function(n){n.id===t&&(e=n)}),e},this.contains=function(t){var e=!1;return this.eachContainer(function(n){return n===t||n.has(t)?e=!0:void 0}),e},this.remove=function(t){var e=null;return t===i?b("cannot remove #body from layer#"+this.id):this.eachContainer(function(n,i){return n===t?(delete r[i],e=t):n.has(t)?(n.remove(t),t.parentLayer=null,t.parentElement=null,e=t):void 0}),e},this.create=function(t){var e,n,r,i=null;return w(t,"#")?(t=t.slice(1),r=ue.get(t),c(r)?b('AbstractElement "'+t+'" does not exist'):(i=r.instantiate(),c(i)?b('Unable to instantiate AbstractElement. Element "'+r.type+'" is not instantiatable or does not exists'):i.edit(arguments[1]))):(e=ce.getInstantiatable(t),c(e)?b('Unable to instantiate Element. "'+t+'" is not instantiatable or does not exists'):(n=f(arguments,1),n.unshift(null),i=new(Function.prototype.bind.apply(e,n)))),i},this.insert=function(t,e,r,i){var s=n(e)?this.create.apply(this,[t].concat(e)):this.create(t,e);return this.add(s,r,i),s},this.moveBefore=function(e,n){return t(e)&&t(n)&&(e.parentElement.remove(e),n.parentElement.addBefore(e,n),e.parentElement=n.parentElement),this},this.moveAfter=function(e,n){return t(e)&&t(n)&&(e.parentElement.remove(e),n.parentElement.addAfter(e,n),e.parentElement=n.parentElement),this},this.select=function(t,e){return[]},this.eachElement=function(t,e){return t.call(e,i),i.each(t,e),this},this.eachContainer=function(t,e){var n;for(n in r)if(!h(t.call(e,r[n],n)))break;return this},this}function ut(t){z.call(this),G.call(this),this.uuid=Yt(),this.wrapper=t,this.readyState="pending",this.screen=new J,this.cursor=new $("mouse"),this.settings=new Q,this.loader=new K,this.queue=new Z,lt.call(this),dt.call(this,t),ft.call(this),pt.call(this),mt.call(this)}function lt(){var t=new q;return this.createLayer=function(t){return s(t)||(t=l()),new ht(Y(t,{width:this.screen.width,height:this.screen.height}))},this.addLayer=function(e,n){return t.add(e,n),e.root=this,this.wrapper.appendChild(e.canvas),this},this.insertLayer=function(t,e){var n=this.createLayer(t);return this.addLayer(n,e),n},this.removeLayer=function(e){return t.remove(e),e.root=null,this.wrapper.removeChild(e.canvas),this},this.getLayer=function(e){var n=null;return t.each(function(t){return t.id===e?(n=t,!0):!1}),n},this.eachLayer=function(e){return t.each(e),this},this.eachElement=function(e){return t.each(function(t){t.eachElement(e)}),this},this}function dt(e){var n=this,r=[],i=[],s=t.document;return this.getDraggedElements=function(){return r},this.getFocusedElements=function(){return i},this.updateFocusedElements=function(t){var e=[],r=this.cursor.x,s=this.cursor.y;return this.cursor.onScreen&&n.eachElement(function(n){var o,a;t.propagationStopped!==!0&&(o=O(i,n),t.target=n,n.dispatchEvent(t.type,t),n.screenX<=r&&n.screenXE>=r&&n.screenY<=s&&n.screenYE>=s?(e.push(n),o||(a=new nt("mouseenter",t.x,t.y,null),a.target=n,n.dispatchEvent(a.type,a))):o&&(a=new nt("mouseleave",t.x,t.y,null),a.target=n,n.dispatchEvent(a.type,a)))}),S(i),i.push.apply(i,e),this},e.addEventListener("mousemove",function(t){var e=t.layerX,r=t.layerY,i=new nt("mousemove",e,r,null);n.cursor.set(e,r),n.cursor.onScreen=!0,i.target=n,i.originalEvent=t,n.dispatchEvent(t.type,i),n.updateFocusedElements(i)}),e.addEventListener("mouseenter",function(t){n.cursor.set(t.layerX,t.layerY),n.cursor.onScreen=!0,n.dispatchEvent(t.type,new nt(t.type,t.layerX,t.layerY,null))}),e.addEventListener("mouseleave",function(t){n.cursor.set(t.layerX,t.layerY),n.cursor.onScreen=!1,C(i,function(t){var e=new nt("mouseleave",n.cursor.x,n.cursor.y,null);e.target=t,t.dispatchEvent(e.type,e)}),S(i),n.dispatchEvent(t.type,new nt(t.type,t.layerX,t.layerY,null))}),e.addEventListener("mousedown",function(t){var e=t.layerX,r=t.layerY,s=new nt("mousedown",e,r,null);switch(n.cursor.set(e,r),n.cursor.onScreen=!0,s.target=n,s.originalEvent=t,t.button){case 0:s.button="left";break;case 1:s.button="middle";break;case 2:s.button="right"}n.dispatchEvent(t.type,s),P(i,z.prototype.dispatchEvent,t.type,s)}),e.addEventListener("mouseup",function(t){var e=t.layerX,r=t.layerY,s=new nt("mouseup",e,r,null);switch(n.cursor.set(e,r),n.cursor.onScreen=!0,s.target=n,s.originalEvent=t,t.button){case 0:s.button="left";break;case 1:s.button="middle";break;case 2:s.button="right"}n.dispatchEvent(t.type,s),P(i,z.prototype.dispatchEvent,t.type,s)}),s.addEventListener("keypress",function(t){var e=t.keyCode||t.which,r=new rt("keypress",e);r.target=n,r.originalEvent=t,n.dispatchEvent("keypress",r)}),s.addEventListener("keydown",function(t){var e=t.keyCode||t.which,r=new rt("keydown",e);r.target=n,r.originalEvent=t,n.dispatchEvent("keydown",r)}),s.addEventListener("keyup",function(t){var e=t.keyCode||t.which,r=new rt("keyup",e);r.target=n,r.originalEvent=t,n.dispatchEvent("keyup",r)}),this}function ft(){var e=null,n=function(){var r=new Date;e=t.requestAnimationFrame(n),this.fps=r-this.lastTick,this.lastTick=r,++this.tickCount,this.update(),this.queue.perform(),this.emit("tick"),this.reflow(),this.checkCollisions(),this.paint()}.bind(this);return this.start=function(){return this.stop(),this.run=!0,n(),this},this.stop=function(){return t.cancelAnimationFrame(e),this.run=!1,this},this}function pt(){function t(t,e,n){this.element=t,this.targets=k(e),this.autoRemove=n!==!1}var e=[],n=t.prototype=l();return n.constructor=t,n.addTarget=function(t){return this.targets=this.targets.concat(t),this},n.removeTarget=function(t){return E(this.targets,t),this},n.check=function(){for(var t,e,n=this.element,r=0,i=this.targets.length;i>r;r++)t=this.targets[r],n.screenX>t.screenXE||n.screenXE<t.screenX||n.screenY>t.screenYE||n.screenYE<t.screenY||(e=new ot("collision",t),e.target=n,n.emit(e.type,e),this.autoRemove===!0&&(this.removeTarget(t),--r,--i));return this},this.watch=function(n,r,i){var s=new t(n,r,i);return e.push(s),s},this.neglect=function(t){return E(e,t),this},this.checkCollisions=function(){return W(e,n.check),this},this}function mt(){return this.settings.edit({volume:40,maxDraggedEntries:1,renderDepthLimit:0}),this}function yt(t,e,n){this.type=t,this.args=h(n)?[]:Array.prototype.concat(n),s(e)&&(this.use=e)}function gt(t,e){at.call(this),vt.call(this),this.id=String(t),this.classList.add(we.elementType,1),this.edit(e)}function vt(){var t=new q;return this.add=function(e,n){return t.add(e,n),this},this.addBefore=function(e,n){return t.addBefore(e,n),this},this.addAfter=function(e,n){return t.addAfter(e,n),this},this.has=function(e){return t.has(e)},this.remove=function(e){return t.remove(e)},this.clear=function(){return t.clear(),this},this.count=function(e){var n=t.count;return e===!0&&this.each(function(t){u(t,gt)&&(n+=t.count(e))}),n},this.getElements=function(){return t.all()},this.first=function(){return t.first()},this.last=function(){return t.last()},this.each=function(e,n,r){return t.each(function(t){e.call(n,t),r!==!1&&u(t,gt)&&t.each(e,n)}),this},this}function bt(){at.call(this),this.classList.add(Ee.elementType,1),B(Se,this.addProp,this)}function xt(t){this.vertices=[[0,0],[1,1]],bt.call(this),this.classList.add(Oe.elementType,2),this.edit(t)}function Tt(t){this.vertices=[[.5,0],[1,1],[0,1]],bt.call(this),this.classList.add(je.elementType,2),this.edit(t)}function wt(t){this.vertices=[[0,0],[1,0],[1,1],[0,1]],bt.call(this),this.classList.add(ke.elementType,2),this.edit(t)}function Lt(t){this.vertices=[[.5,0],[1,.4],[.8,1],[.2,1],[0,.4]],bt.call(this),this.classList.add(Ce.elementType,2),this.edit(t)}function Et(t){this.vertices=[[.25,0],[.75,0],[1,.5],[.75,1],[.25,1],[0,.5]],bt.call(this),this.classList.add(We.elementType,2),this.edit(t)}function St(t){this.vertices=[[0,1],[.5,0],[1,1],[0,.3],[1,.3]],bt.call(this),this.classList.add(Pe.elementType,2),this.edit(t)}function Ot(t){at.call(this),this.classList.add(Ae.elementType,1),B(Xe,this.addPropSafe,this),this.edit(t)}function jt(t){at.call(this),this.classList.add(Ye.elementType,1),B(Re,this.addProp,this),this.edit(t)}function kt(t){at.call(this),this.classList.add(Be.elementType,1),B(Ie,this.addPropSafe,this),this.edit(t)}function Ct(t){at.call(this),this.classList.add(He.elementType,1),B(Me,this.addPropSafe,this),this.img=new Image,this.edit(t)}function Wt(t){at.call(this),this.classList.add(Ne.elementType,1),B(Fe,this.addPropSafe,this),this.img=new Image,this.edit(t)}function Pt(t){at.call(this),this.classList.add(De.elementType,1),B(ze,this.addPropSafe,this),this.img=new Image,this.frames=[],this.animations=l(),this.currentAnimationFrame={x:0,y:0},this.edit(t)}t.requestAnimationFrame=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.msRequestAnimationFrame||t.oRequestAnimationFrame,t.cancelAnimationFrame=t.cancelAnimationFrame||t.webkitCancelAnimationFrame||t.mozCancelAnimationFrame||t.msCancelAnimationFrame||t.oCancelAnimationFrame;var At=/[+-]?(?:\d*\.|)\d+/,Xt=/\n/,Yt=function(){function t(t){var e=16*Math.random()|0,n="x"===t?e:3&e|8;return n.toString(16)}var e=/[xy]/g;return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(e,t)}}(),Rt=function(){function t(t){return"[object Array]"===Object.prototype.toString.call(t)}var e=/^{{(.*)}}$/;return function(n,r,i){var s,o=String(n).match(e);return t(o)?(s=new Function(t(i)?i.join(","):"",o[1]),"object"==typeof r?s.bind(r):s):null}}(),Bt=function(){var t=/[+-]?(?:\d*\.|)\d+/;return function(e,n){var r;return"number"!=typeof n?0:(e=String(e),r=e.match(t),null===r?0:Number(r[0])*n/100)}}(),It=function(){function t(t,e){for(var n=0,r=t.length;r>n;n++)if(t[n]===e)return!0;return!1}function e(e){var i=typeof e;return t(n,i)?i:null===e?"null":"[object Array]"===r.call(e)?"array":"object"}var n=["string","number","boolean","undefined","function"],r=Object.prototype.toString,i=Object.prototype.hasOwnProperty;return function s(t,n){var r,o,a,h,c,u;for(r in n)if(i.call(n,r))switch(o=t[r],a=n[r],h=e(a),e(o)){case"function":if("array"===h)if(u=a.length,0===u)o.call(t);else for(c=0;u>c;c++)"array"===e(a[c])?o.apply(t,a[c]):o.call(t,a[c]);else o.call(t,a);break;case"string":case"boolean":case"number":case"undefined":case"null":t[r]=a;break;case"array":"array"===h?o.push.apply(o,a):o.push(a);break;case"object":"object"===h?s(o,a):t[r]=a}return t}}(),Ht=function(){function t(t){return t.toUpperCase()}var e=/(?:^|\s)\S/g;return function(n){return n.replace(e,t)}}(),Mt=t.document,Nt=(Mt.body,Object.create(null));Nt.get=function(){function t(t,e){var n=e.target;4===n.readyState&&200===n.status&&t(n.responseText)}return function(e,n){var r=new XMLHttpRequest;return r.open("GET",e,!0),r.onreadystatechange=t.bind(r,n),r.send(null),r}}(),Nt.getJSON=function(t,e){return Nt.get(t,function(t){e(JSON.parse(t))})},Nt.post=function(t,e,n){var r=new XMLHttpRequest;return r.open("POST",t,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=n,r.send(null),r},N.each=function(t,e){var n,r=Object.prototype.hasOwnProperty;for(n in t)r.call(t,n)&&e(n,t[n]);return t};var Ft=N.prototype=Object.create(null);Ft.constructor=N;var Dt=D.prototype=Object.create(null);Dt.constructor=D,Dt.type=null,Dt.originalEvent=null,Dt.target=null,Dt.data=null,Dt.timeStamp=0,Dt.cancelable=!0,Dt.defaultPrevented=!1,Dt.propagationStopped=!1,Dt.returnValue=null,Dt.preventDefault=function(){return this.cancelable===!0&&(this.defaultPrevented=!0),this},Dt.stopPropagation=function(){return this.propagationStopped=!0,this},Dt.toString=function(){return this.type+" Event"},z.transmit=function(t,e,n){return e.on(t,function(){n.dispatchEvent(t)}),n};var zt=z.prototype=Object.create(null);zt.constructor=z,zt.addEventListener=function(t,e){var n=this.eventList[t]||(this.eventList[t]=[]);return n.push(e),this},zt.hasEventListener=function(t){var e=this.eventList[t];return!!e&&e.length>0},zt.removeEventListener=function(t,e){var n,r=this.eventList[t];return void 0!==r&&(n=r.indexOf(e),-1!==n&&r.splice(n,1)),this},zt.removeAllEventListeners=function(){var t,e=this.eventList,n=Object.prototype.hasOwnProperty;for(t in e)n.call(e,t)&&delete e[t];return this},zt.dispatchEvent=function(t){var e,n,r,i=this.eventList[t];if(void 0!==i)for(e=Array.prototype.slice.call(arguments,1),n=0,r=i.length;r>n;n++)i[n].apply(this,e);return this},zt.eachEventListener=function(t,e){var n,r,i;if(this.hasEventListener(t))for(n=this.eventList[t],r=0,i=n.length;i>r;r++)e(n[r],r);return this},zt.on=zt.addEventListener,zt.off=zt.removeEventListener,zt.offAll=zt.removeAllEventListeners,zt.emit=zt.dispatchEvent,zt.toString=function(){return"[object EventTarget]"};var qt=q.prototype=Object.create(null);qt.constructor=q,qt.toString=function(){return"[object OrderedList]"};var Qt=Q.prototype=Object.create(null);Qt.constructor=Q,Qt.get=function(t){return Object.prototype.hasOwnProperty.call(this.data,t)?this.data[t]:null},Qt.set=function(t,e){return this.data[t]=e},Qt.edit=function(t){var e,n=Object.prototype.hasOwnProperty,r=this.data;for(e in t)n.call(t,e)&&(r[e]=t[e]);return this};var Ut=U.prototype=Object.create(null);Ut.constructor=U;var Gt=G.prototype=Object.create(null);Gt.constructor=G;var Vt=V.prototype=Object.create(null);Vt.constructor=V,Vt.x=0,Vt.y=0,Vt.set=function(t,e){return this.x=t,this.y=e,this},Vt.setX=function(t){return this.x=t,this},Vt.setY=function(t){return this.y=t,this},Vt.add=function(t){return this.x+=t.x,this.y+=t.y,this},Vt.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},Vt.addScalar=function(t){return this.x+=t,this.y+=t,this},Vt.sub=function(t){return this.x-=t.x,this.y-=t.y,this},Vt.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},Vt.subScalar=function(t){return this.x-=t,this.y-=t,this},Vt.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},Vt.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},Vt.divide=function(t){return this.x=0===t.x?0:this.x/t.x,this.y=0===t.y?0:this.y/t.y,this},Vt.divideScalar=function(t){return this.x=0===t?0:this.x/t,this.y=0===t?0:this.y/t,this},Vt.min=function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this},Vt.max=function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this},Vt.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},Vt.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},Vt.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},Vt.negate=function(){return this.x=-this.x,this.y=-this.y,this},Vt.rotate=function(t){var e=Math.cos(t),n=Math.sin(t),r=this.x*e-this.y*n,i=this.x*n+this.y*e;return this.x=r,this.y=i,this},Vt.setLength=function(t){return this.normalize().multiplyScalar(t.length()),this},Vt.dot=function(t){return this.x*t.x+this.y*t.y},Vt.cross=function(t){return this.x*t.y-this.y*t.x},Vt.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Vt.normalize=function(){return this.divideScalar(this.length())},Vt.toAngle=function(t){return this.rotate(2*Math.PI-Math.atan2(this.y,this.x)+t),this},Vt.distanceTo=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},Vt.angleTo=function(t){return Math.atan2(t.cross(this),t.dot(this))},Vt.equals=function(t){return this.x===t.x&&this.y===t.y},Vt.copy=function(t){return this.x=t.x,this.y=t.y,this},Vt.clone=function(){return new this.constructor(this.x,this.y)},Vt.toString=function(){return"Vector2 at "+this.x+" "+this.y};var Jt=J.prototype=Object.create(null);Jt.constructor=J,Jt.pos=null,Jt.width=0,Jt.height=0,Jt.toString=function(){return"Screen["+this.width+", "+this.height+"] at "+this.pos.x+", "+this.pos.y};var $t=$.prototype=Object.create(V.prototype);$t.constructor=$,$t.type="mouse",$t.onScreen=!1,$t.toString=function(){return"Cursor at "+this.x+", "+this.y};var _t=_.prototype=Object.create(q.prototype);_t.constructor=_,_t.add=function(t,e){return t=String(t),this.reOrder(t,e),this},_t.toggle=function(t,e){return this.has(t)?this.remove(t):this.add(t,e)},_t.toString=function(){return"[object ClassList]"},K.IMG="Image",K.AUDIO="Audio";var Kt=K.prototype=Object.create(z.prototype);Kt.constructor=K,Kt.basePath="",Kt.status="pending",Kt.loadQueue=null,Kt.setPathList=null,Kt.start=function(){var t;for(this.emit("start");t=this.setPathList.pop();)t();return 0===this.loadQueue.length?(this.status="complete",this.emit("complete")):this.status="processing",this},Kt.clear=function(){return this.loadQueue=[],this.setPathList=[],this},Kt.reset=function(){return this.status="pending",this.clear(),this.offAll(),this},Kt.load=function(t,e,n){var r=this["load"+t];return"function"==typeof r?r.call(this,e,n,!0):null},Kt.loadImage=function(t,e,n){var r=this,i=new Image,s=function(s){var o=new st(s.type,i);o.originalEvent=s,o.data.type=K.IMG,o.data.src=t,r.remove(i),n||r.emit(s.type,o),"function"==typeof e&&e.call(i,s)};return i.addEventListener("load",s),i.addEventListener("error",s),n===!0&&(i.src=t),i},Kt.loadAudio=function(t,e,n){var r=this,i=new Audio,s=function(s){var o=new st(s.type,i);o.originalEvent=s,o.data.type=K.AUDIO,o.data.src=t,r.remove(i),n||r.emit(s.type,o),"function"==typeof e&&e.call(i,s)};return i.addEventListener("canplaythrough",s),i.addEventListener("error",s),n&&(i.src=t),i},Kt.add=function(t,e){var n=this["add"+t];return"function"==typeof n?n.call(this,e):null},Kt.addImage=function(t){var e=this.loadImage(t,null,!1);return this.setPathList.push(function(){e.src=t}),this.loadQueue.push(e),e},Kt.addAudio=function(t){var e=this.loadAudio(t,null,!1);return this.setPathList.push(function(){e.src=t}),this.loadQueue.push(e),e},Kt.remove=function(t){var e,n=this.loadQueue.indexOf(t);return-1!==n?(e=this.loadQueue.splice(n,1)[0],0===this.loadQueue.length&&this.emit("complete"),e):null};var Zt=Z.prototype=Object.create(null);Zt.constructor=Z,Zt.add=function(t,e){return this.taskList.push(t),e!==!1&&t.reset(),this},Zt.remove=function(t){var e=this.taskList.indexOf(t);return-1!==e&&this.taskList.splice(e,1),this},Zt.clear=function(){for(var t=this.taskList;t.length;)t.pop();return this},Zt.restoreTask=function(t){return this.remove(t).add(t,!0),this},Zt.each=function(t){return this.taskList.forEach(t,this),this},Zt.perform=function(){function t(t){t.execute()===!0&&this.remove(t)}return function(){return this.each(t),this}}(),Zt.toString=function(){return"[object Queue]"};var te=tt.prototype=Object.create(null);te.constructor=tt,te.execute=function(){var t=new Date;return t-this.lastTime>=this.interval?(this.lastTime=t,this.listener.call(this.thisArg,this.tick++,t-this.startTime,this)):!1},te.reset=function(){var t=new Date;return this.startTime=t,this.lastTime=t,this.tick=0,this},te.toString=function(){return"[object Task]"};var ee=et.prototype=Object.create(null);ee.constructor=et,ee.items=null,ee.count=function(){return this.keys().length},ee.set=function(t,e){return this.items[t]=e,this},ee.setSafe=function(t,e){return this.has(t)||(this.items[t]=e),this},ee.get=function(t){return this.has(t)?this.items[t]:null},ee.has=function(t){return t in this.items},ee.remove=function(t){return delete this.items[t],this},ee.clear=function(){return this.items=Object.create(null),this},ee.each=function(t,e){var n,r=0;for(n in this.items)t.call(e,n,this.items[n],r++);return this},ee.keys=function(){var t,e=[];for(t in this.items)e.push(t);return e},ee.values=function(){var t,e=[];for(t in this.items)e.push(this.items[t]);return e},ee.all=function(){var t,e={};for(t in this.items)e[t]=this.items[t];return e};var ne=nt.prototype=Object.create(D.prototype);ne.constructor=nt,ne.x=0,ne.y=0,ne.button=null;var re=rt.prototype=Object.create(D.prototype);re.constructor=rt,re.keyCode=null,re.character=null;var ie=it.prototype=Object.create(D.prototype);ie.constructor=it,ie.dragStartX=null,ie.dragStartY=null,ie.dragged=null;var se=st.prototype=Object.create(D.prototype);se.constructor=st;var oe=ot.prototype=Object.create(D.prototype);oe.constructor=ot,oe.objectives=null;var ae=l(),he=l();he.ELEMENT_FLOWS=new N("none","horizontal","vertical");var ce=l();ce.types=l(),ce.addType=function(t,e,n,r){return this.types[t]=A(l(),{constructor:e,instantiatable:n!==!1,extendable:r!==!1}),this},ce.hasType=function(t){return t in this.types},ce.getType=function(t){return this.hasType(t)?this.types[t]:null},ce.getInstantiatable=function(t){var e=this.getType(t);return c(e)||e.instantiatable!==!0?null:e.constructor},ce.getExtendable=function(t){var e=this.getType(t);return c(e)||e.extendable!==!0?null:e.constructor},ce.removeType=function(t){return delete this.types[t],this};var ue=d(et);ae.createAbstractElement=function(t,e,n,r){return ue.set(t,new yt(e,n,r)),this};var le=d(et);le.fromPrototype=function(t,e){var r=l();return n(e)||(e=[]),B(t,function(n,s){var o=Object.getOwnPropertyDescriptor(t,n);c(s)||i(o.get)||i(o.set)||i(s)||O(e,n)||(r[n]=s)}),r},ae.createClass=function(t,e){return le.set(t,e),this};var de=d(et),fe=d(et),pe=l();pe.types=l(),pe.loaders=[],pe.getLoader=function(){for(var t,e=0,n=this.loaders.length;n>e;e++)if(t=this.loaders[e],"pending"===t.status)return t;return t=new K,this.loaders.push(t),t},pe.addType=function(t){var e;return this.hasType(t)||(e=l(),e.sourceMap=l(),e.IDMap=l(),this.types[t]=e),this},pe.hasType=function(t){return!h(this.types[t])},pe.getByID=function(t,e){return this.hasType(t)?this.types[t].IDMap[e]||null:null},pe.getBySrc=function(t,e){return this.hasType(t)?this.types[t].sourceMap[e]||null:null},pe.getAll=function(t){var e=[];return this.hasType(t)&&(B(this.types[t].sourceMap,function(t,n){j(e,n)}),B(this.types[t].IDMap,function(t,n){j(e,n)})),e},pe.clear=function(){return this.types=l(),this},pe.addItem=function(t,e,n,r){var i=this.addType(t).types[t];return i.sourceMap[n]=e,h(r)||(i.IDMap[r]=e),this},pe.addType(K.IMG),pe.addType(K.AUDIO);var me=l();me.DOMElement=M("canvas"),me.ctx=me.DOMElement.getContext("2d");var ye=at.prototype=Object.create(z.prototype);ye.constructor=at;var ge=function(){function t(t,e,n){this.key=t,this.edit(e,n),this.initialValue=this.value,this.value="inherit"}var e=t.prototype=l();return e.constructor=t,e.edit=function(t,e){var n=Rt(t);return this.primitiveValue=t,this.value=c(n)?t:n,this.type=i(this.value)?"method":"property",r(e)&&(this.inheritable=e),this},function(){var e=l();return this.addProp=function(n,s,o){return r(o)||(o=!0),this.hasProp(n)&&b(this.toString()+" already has property "+n),e[n]=new t(n,s,o),Object.defineProperty(this,n,{configurable:!0,enumerable:!1,get:function(){var t=e[n].value;return"inherit"===t&&(t=this.classList.execute(function(t){var r=le.get(t);return c(r)||h(r[n])||"inherit"===r[n]?void 0:"initial"===r[n]?e[n].initialValue:r[n]},this)),i(t)?t.call(this):t},set:function(t){return e[n].edit(t).value}}),this},this.addPropSafe=function(t,e,n){return this.hasProp(t)||this.addProp(t,e,n),this},this.hasProp=function(t){return X(e,t)},this.removeProp=function(t){return X(e,t)&&(delete e[t],delete this[t]),this},this.setProp=function(t,n,r){return X(e,t)&&e[t].edit(n,r),this},this.getProp=function(t){return e[t]||null},this.getProps=function(t){var n=[];return B(e,function(e,r){return(h(t)||t.call(this,e,r)===!0)&&n.push(r),!1},this),n},this}}();ye.elementType="Element",ye.elementName="Element",ye.id=null,ye.uuid=null,Object.defineProperty(ye,"className",{get:function(){return this.classList.all().join(" ")}}),ye.parentLayer=null,ye.parentElement=null,Object.defineProperty(ye,"vX",{get:function(){return this.velocity.x},set:function(t){return this.velocity.setX(t).x}}),Object.defineProperty(ye,"vY",{get:function(){return this.velocity.y},set:function(t){return this.velocity.setY(t).y}}),ye.x=0,ye.y=0,ye.maxX="none",ye.maxY="none",ye.minX="none",ye.minY="none",ye.offsetX=0,ye.offsetY=0,ye.width=0,ye.height=0,ye.maxWidth="none",ye.maxHeight="none",ye.minWidth="none",ye.minHeight="none",ye.top=0,ye.right=0,ye.bottom=0,ye.left=0,ye.screenX=0,ye.screenY=0,ye.parentX=0,ye.parentY=0,ye.renderWidth=0,ye.renderHeight=0,Object.defineProperties(ye,{screenXC:{get:function(){return this.screenX+this.renderWidth/2}},screenYC:{get:function(){return this.screenY+this.renderHeight/2}},screenXE:{get:function(){return this.screenX+this.renderWidth}},screenYE:{get:function(){return this.screenY+this.renderHeight}},parentXC:{get:function(){return this.parentX+this.renderWidth/2}},parentYC:{get:function(){return this.parentY+this.renderHeight/2}},parentXE:{get:function(){return this.parentX+this.renderWidth}},parentYE:{get:function(){return this.parentY+this.renderHeight}}}),ye.scaleX=1,ye.scaleY=1,ye.angle=0,ye.flipX=!1,ye.flipY=!1,ye.flow="none",ye.wrap=!0,ye.dragState=!1,ye.onFocus=!1,ye.isBlock=!0,ye.cursor="default",ye.allowDrop=!1,ye.title="",ye.opacity=1,ye.background="",ye.mask="",ye.horizontalAlign="left",ye.verticalAlign="top",ye.marginTop=0,ye.marginRight=0,ye.marginBottom=0,ye.marginLeft=0,Object.defineProperty(ye,"margin",{get:function(){return this.marginTop+" "+this.marginRight+" "+this.marginBottom+" "+this.marginLeft;
},set:function(t){var e=t.split(" "),n=e.length;return 1===n?(this.marginTop=e[0],this.marginRight=e[0],this.marginBottom=e[0],this.marginLeft=e[0]):2===n?(this.marginTop=e[0],this.marginRight=e[1],this.marginBottom=e[0],this.marginLeft=e[1]):3===n?(this.marginTop=e[0],this.marginRight=e[1],this.marginBottom=e[2],this.marginLeft=e[1]):(this.marginTop=e[0],this.marginRight=e[1],this.marginBottom=e[2],this.marginLeft=e[3]),this.margin}}),ye.paddingTop=0,ye.paddingRight=0,ye.paddingBottom=0,ye.paddingLeft=0,Object.defineProperty(ye,"padding",{get:function(){return this.paddingTop+" "+this.paddingRight+" "+this.paddingBottom+" "+this.paddingLeft},set:function(t){var e=t.split(" "),n=e.length;return 1===n?(this.paddingTop=e[0],this.paddingRight=e[0],this.paddingBottom=e[0],this.paddingLeft=e[0]):2===n?(this.paddingTop=e[0],this.paddingRight=e[1],this.paddingBottom=e[0],this.paddingLeft=e[1]):3===n?(this.paddingTop=e[0],this.paddingRight=e[1],this.paddingBottom=e[2],this.paddingLeft=e[1]):(this.paddingTop=e[0],this.paddingRight=e[1],this.paddingBottom=e[2],this.paddingLeft=e[3]),this.padding}}),Object.defineProperty(ye,"border",{get:void 0,set:function(t){var e=t.split(" "),n=e.length;return n>=1&&(this.borderTopWidth=e[0],this.borderRightWidth=e[0],this.borderBottomWidth=e[0],this.borderLeftWidth=e[0]),n>=2&&(this.borderTopStyle=e[1],this.borderRightStyle=e[1],this.borderBottomStyle=e[1],this.borderLeftStyle=e[1]),3===n&&(this.borderTopColor=e[2],this.borderRightColor=e[2],this.borderBottomColor=e[2],this.borderLeftColor=e[2]),t}}),Object.defineProperty(ye,"borderTop",{get:void 0,set:function(t){var e=t.split(" "),n=e.length;return n>=1&&(this.borderTopWidth=e[0]),n>=2&&(this.borderTopStyle=e[1]),3===n&&(this.borderTopColor=e[2]),t}}),Object.defineProperty(ye,"borderRight",{get:void 0,set:function(t){var e=t.split(" "),n=e.length;return n>=1&&(this.borderRightWidth=e[0]),n>=2&&(this.borderRightStyle=e[1]),3===n&&(this.borderRightColor=e[2]),t}}),Object.defineProperty(ye,"borderBottom",{get:void 0,set:function(t){var e=t.split(" "),n=e.length;return n>=1&&(this.borderBottomWidth=e[0]),n>=2&&(this.borderBottomStyle=e[1]),3===n&&(this.borderBottomColor=e[2]),t}}),Object.defineProperty(ye,"borderLeft",{get:void 0,set:function(t){var e=t.split(" "),n=e.length;return n>=1&&(this.borderLeftWidth=e[0]),n>=2&&(this.borderLeftStyle=e[1]),3===n&&(this.borderLeftColor=e[2]),t}}),ye.borderTopWidth=0,ye.borderRightWidth=0,ye.borderBottomWidth=0,ye.borderLeftWidth=0,Object.defineProperty(ye,"borderWidth",{get:function(){return this.borderTopWidth+" "+this.borderRightWidth+" "+this.borderBottomWidth+" "+this.borderLeftWidth},set:function(t){var e=t.split(" "),n=e.length;return 1===n?(this.borderTopWidth=e[0],this.borderRightWidth=e[0],this.borderBottomWidth=e[0],this.borderLeftWidth=e[0]):2===n?(this.borderTopWidth=e[0],this.borderRightWidth=e[1],this.borderBottomWidth=e[0],this.borderLeftWidth=e[1]):3===n?(this.borderTopWidth=e[0],this.borderRightWidth=e[1],this.borderBottomWidth=e[2],this.borderLeftWidth=e[1]):(this.borderTopWidth=e[0],this.borderRightWidth=e[1],this.borderBottomWidth=e[2],this.borderLeftWidth=e[3]),this.borderWidth}}),ye.borderTopStyle="none",ye.borderRightStyle="none",ye.borderBottomStyle="none",ye.borderLeftStyle="none",Object.defineProperty(ye,"borderStyle",{get:function(){return this.borderTopStyle+" "+this.borderRightStyle+" "+this.borderBottomStyle+" "+this.borderLeftStyle},set:function(t){var e=t.split(" "),n=e.length;return 1===n?(this.borderTopStyle=e[0],this.borderRightStyle=e[0],this.borderBottomStyle=e[0],this.borderLeftStyle=e[0]):2===n?(this.borderTopStyle=e[0],this.borderRightStyle=e[1],this.borderBottomStyle=e[0],this.borderLeftStyle=e[1]):3===n?(this.borderTopStyle=e[0],this.borderRightStyle=e[1],this.borderBottomStyle=e[2],this.borderLeftStyle=e[1]):(this.borderTopStyle=e[0],this.borderRightStyle=e[1],this.borderBottomStyle=e[2],this.borderLeftStyle=e[3]),this.borderStyle}}),ye.borderTopColor="none",ye.borderRightColor="none",ye.borderBottomColor="none",ye.borderLeftColor="none",Object.defineProperty(ye,"borderColor",{get:function(){return this.borderTopColor+" "+this.borderRightColor+" "+this.borderBottomColor+" "+this.borderLeftColor},set:function(t){var e=t.split(" "),n=e.length;return 1===n?(this.borderTopColor=e[0],this.borderRightColor=e[0],this.borderBottomColor=e[0],this.borderLeftColor=e[0]):2===n?(this.borderTopColor=e[0],this.borderRightColor=e[1],this.borderBottomColor=e[0],this.borderLeftColor=e[1]):3===n?(this.borderTopColor=e[0],this.borderRightColor=e[1],this.borderBottomColor=e[2],this.borderLeftColor=e[1]):(this.borderTopColor=e[0],this.borderRightColor=e[1],this.borderBottomColor=e[2],this.borderLeftColor=e[3]),this.borderColor}}),ye.draggable=!1,ye.mousemove=function(t){return o(t)&&(t=Rt(t)),i(t)&&this.addEventListener("mousemove",t),this},ye.mouseenter=function(t){return o(t)&&(t=Rt(t)),i(t)&&this.addEventListener("mouseenter",t),this},ye.mouseleave=function(t){return o(t)&&(t=Rt(t)),i(t)&&this.addEventListener("mouseleave",t),this},ye.mousedown=function(t){return o(t)&&(t=Rt(t)),i(t)&&this.addEventListener("mousedown",t),this},ye.mouseup=function(t){return o(t)&&(t=Rt(t)),i(t)&&this.addEventListener("mouseup",t),this},ye.edit=function(t){return It(this,t)},ye.getScene=function(){var t=this.parentLayer;return u(t,ht)&&u(t.root,ut)?t.root:null},ye.isChildOf=function(t){var e=t;do{if(this.parentElement===e)return!0;e=e.parentElement}while(u(e,gt));return!1},ye.scale=function(t,e){return this.scaleX=t,this.scaleY=e,this},ye.addClass=function(t,e){return this.classList.add(t,e),this},ye.toggleClass=function(t,e){return this.classList.toggle(t,e),this},ye.removeClass=function(t){return this.classList.remove(t),this},ye.toggle=function(t){return r(this[t])&&(this[t]=!this[t]),this},ye.applyTransform=function(t){var e,n,r=a(this.angle)?g(this.angle%360):0,i=a(this.scaleX)?this.scaleX:1,s=a(this.scaleY)?this.scaleY:1;return this.flipX===!0&&(i*=-1),this.flipY===!0&&(s*=-1),0===r&&1===i&&1===s||(e=this.screenX+this.renderWidth/2,n=this.screenY+this.renderHeight/2,t.translate(e,n),0!==r&&t.rotate(r),1===i&&1===s||t.scale(i,s),t.translate(-e,-n)),this},ye.applyMask=function(t){var e=de.get(this.mask);return c(e)||(t.beginPath(),e(t,this),t.clip()),this},ye.drawBox=function(t){var e=this.screenX,n=this.screenY,r=this.renderWidth,i=this.renderHeight;return""!==this.background&&(t.fillStyle=this.background,t.fillRect(e,n,r,i)),this.borderTopWidth>0&&(t.beginPath(),t.lineWidth=this.borderTopWidth,t.strokeStyle=this.borderTopColor,t.moveTo(e,n),t.lineTo(e+r,n),t.stroke()),this.borderRightWidth>0&&(t.beginPath(),t.lineWidth=this.borderRightWidth,t.strokeStyle=this.borderRightColor,t.moveTo(e+r,n),t.lineTo(e+r,n+i),t.stroke()),this.borderBottomWidth>0&&(t.beginPath(),t.lineWidth=this.borderBottomWidth,t.strokeStyle=this.borderBottomColor,t.moveTo(e+r,n+i),t.lineTo(e,n+i),t.stroke()),this.borderLeftWidth>0&&(t.beginPath(),t.lineWidth=this.borderLeftWidth,t.strokeStyle=this.borderLeftColor,t.moveTo(e,n+i),t.lineTo(e,n),t.stroke()),this},ye.update=function(){return a(this.x)&&a(this.vX)&&(this.x+=this.vX,a(this.minX)&&this.x<this.minX&&(this.x=this.minX),a(this.maxX)&&this.x>this.maxX&&(this.x=this.maxX)),a(this.y)&&a(this.vY)&&(this.y+=this.vY,a(this.minY)&&this.y<this.minY&&(this.y=this.minY),a(this.maxY)&&this.y>this.maxY&&(this.y=this.maxY)),this},ye.animation=function(t,e,n){var r=I(this,R(t)),i=function(n,i){var s=y(0,1,i/(e||0));return B(r,function(e){this[e]=r[e]+(t[e]-r[e])*s},this),1===s};return new tt(i,n,this)},ye.animate=function(t,e,n){var r=this.getScene(),i=null;return u(r,ut)&&(i=this.animation(t,e,n),r.queue.add(i,!0)),i},ye.clone=function(){var t,e,n=ce.getInstantiatable(this.elementName),r=null;return c(n)||(t=l(),e=this.getProps(),C(e,function(e){"inherit"!==e.value&&(t[e.key]=e.value)}),r=new n(t)),r},ye.toString=function(){return"Chill Element["+this.elementType+"]"};var ve=le.fromPrototype(ye,["elementType","elementName","top","right","bottom","left","screenX","screenY","parentX","parentY","renderWidth","renderHeight","onFocus","dragState"]);ce.addType(ye.elementName,at,!1,!0),le.set(ye.elementType,ve);var be=ht.prototype=Object.create(z.prototype);be.constructor=ht,be.root=null,be.id=null,be.uuid=null,Object.defineProperty(be,"x",{get:function(){return m(this.canvas.style.left)||0},set:function(t){return this.canvas.style.left=t+"px"}}),Object.defineProperty(be,"y",{get:function(){return m(this.canvas.style.top)||0},set:function(t){return this.canvas.style.top=t+"px"}}),Object.defineProperty(be,"width",{get:function(){return this.canvas.width},set:function(t){return this.canvas.width=t}}),Object.defineProperty(be,"height",{get:function(){return this.canvas.height},set:function(t){return this.canvas.height=t}}),Object.defineProperty(be,"zIndex",{get:function(){return+this.canvas.style.zIndex},set:function(t){return+(this.canvas.style.zIndex=t)}}),Object.defineProperty(be,"background",{get:function(){return this.canvas.style.background},set:function(t){return this.canvas.style.background=t}}),Object.defineProperty(be,"opacity",{get:function(){return this.ctx.globalAlpha},set:function(t){return this.ctx.globalAlpha=t}}),be.live=!0,be.visible=!0,be.render=function(){function t(t){var e=this.ctx;t.opacity>0&&(e.save(),e.globalAlpha=t.opacity,t.applyTransform(e),t.applyMask(e),t.drawBox(e),t.draw(e),e.restore())}return function(){return this.visible===!0&&(this.clear(),this.eachElement(t,this)),this}}(),be.clear=function(){return this.ctx.clearRect(0,0,this.width,this.height),this},be.getPixel=function(t,e){return this.ctx.getImageData(t,e,1,1).data},be.scrollTo=function(t,e){return this.x=t,this.y=e,this},be.scrollBy=function(t,e){return this.x+=t,this.y+=e,this},be.toString=function(){return"Chill Layer"};var xe=ut.prototype=Object.create(z.prototype);xe.constructor=ut,xe.uuid=null,xe.readyState=null,xe.run=!1,xe.lastTick=0,xe.tickCount=0,xe.fps=0,xe.include=function(t,e){var n=this;return o(t)?Nt.getJSON(t,function(t){It(n,t),i(e)&&e(n)}):(s(t)&&It(n,t),i(e)&&e(n)),n},xe.preload=function(t,e){var n=this,r=pe.getLoader(),i=function(){n.emit("preloadComplete"),r.reset()};return r.on("complete",i),B(e,function(e,n){n=k(n),C(n,function(n){var i=n.split(" as "),s=i[0].replace(/^@/,t),o=i[1],a=r.add(e,s,o);c(a)||pe.addItem(e,a,s,o)},this)},this),r.start(),this},xe.playAudio=function(t,e,n,r){return o(t)&&w(t,"#")&&(t=pe.getByID(K.AUDIO,t.slice(1))),u(t,Audio)&&(h(e)&&(e=this.settings.get("volume")),H(t,e,n,r)),this},xe.resize=function(t,e){return this.setWidth(t),this.setHeight(e),this},xe.setWidth=function(t){return this.screen.width=t,this.wrapper.style.width=t+"px",this},xe.setHeight=function(t){return this.screen.height=t,this.wrapper.style.height=t+"px",this},xe.addTask=function(t,e,n){var r=new tt(t,e,n);return this.queue.add(r),r},xe.removeTask=function(t){return this.queue.remove(t),this},xe.later=function(t,e,n){return this.queue.add(new tt(function(){return t.apply(this,f(arguments)),!0},e,n)),this},xe.repeat=function(t,e,n,r){var i=0;return this.queue.add(new tt(function(){return t.apply(this,f(arguments)),++i>=e},n,r)),this},xe.onScreen=function(t,e){var n=this.screen.pos.x,r=this.screen.pos.y,i=n+this.screen.width,s=r+this.screen.height;return e===!1?t.screenX>=n&&t.screenY>=r&&t.screenXE<=i&&t.screenYE<=s:!(n>t.screenXE||i<t.screenX||r>t.screenYE||s<t.screenY)},xe.addPlugin=function(t,e){var n,r=fe.get(t);return c(r)?b('cannot add plugin "'+t+'", plugin does not exists'):t in this?b('cannot add plugin "'+t+'", already exists in scene'):(n=Object.create(r.config),s(e)&&A(n,e),this[t]=r.constructor.call(this,n),this[t].config=n),this},xe.createAbstractElement=ae.createAbstractElement,xe.createClass=ae.createClass,xe.update=function(){function t(t){t.update()}return function(){return this.eachElement(t),this}}(),xe.reflow=function(){function t(t){n(t.body,0,0,t.width,t.height,0,0,0,0)}function n(t,e,s,o,h,c,l,d,f){var p,m,g,v,b,x,T,w,L=t.minWidth,E=t.minHeight,S=t.maxWidth,O=t.maxHeight,j=r(t.marginTop,h),k=r(t.marginRight,o),C=r(t.marginBottom,h),W=r(t.marginLeft,o),P=t.width,A=t.height,X=t.flow;switch("horizontal"===X?(b=d,x=c):"vertical"===X?(b=l,x=f):(b=r(t.x,o)+e,x=r(t.y,h)+s),b+=W,x+=j,P){case"fit":P=o-(b-e);break;case"auto":P=i(t.measureWidth)?t.measureWidth():0;break;default:P=r(P,o)}switch(A){case"fit":A=h-(x-s);break;case"auto":A=i(t.measureHeight)?t.measureHeight():0;break;default:A=r(A,h)}if("none"!==L&&(P=Math.max(P,r(L,o))),"none"!==S&&(P=Math.min(P,r(S,o))),"none"!==E&&(A=Math.max(A,r(E,o))),"none"!==O&&(A=Math.min(A,r(O,o))),"vertical"===X)switch(t.horizontalAlign){case"center":b=l+d/2-P/2;break;case"right":b=d-P}if(m=b,g=b+P+k,"horizontal"===X)switch(t.verticalAlign){case"middle":x=c+f/2-A/2;break;case"bottom":x=f-A}return p=x,v=x+A+C,t.wrap===!0&&("horizontal"===X?g>e+o&&(b=e+W,x=f+j,p=x,g=b+P+k,v=x+A+C,m=b):"vertical"===X&&v>s+h&&(b=d+W,x=s+j,p=x,g=b+P+k,v=x+A+C,m=b)),u(t,gt)&&(v=p,g=m,t.each(function(t){var r=n(t,b,x,P,A,p,m,g,v);"horizontal"!==r.flow&&"vertical"!==r.flow||(p=y(s,p,r.top),g=Math.max(g,r.right),v=Math.max(v,r.bottom),m=y(e,m,r.left))},null,!1)),t.top=p,t.right=g,t.bottom=v,t.left=m,T=r(t.offsetX,P),w=r(t.offsetY,A),a(T)&&(b+=T),a(w)&&(x+=w),t.screenX=b,t.screenY=x,t.parentX=b-e,t.parentY=x-s,t.renderWidth=P,t.renderHeight=A,t}function r(t,n){var r;if(a(t))return t;if(t=String(t),!a(n))return 0;switch(t){case"left":return 0;case"center":return n/2;case"right":return n;case"stick left":return n;case"stick center":return 1.5*n;case"stick right":return 2*n}return r=e(At,t),c(r)?0:(r=Number(r),w(t,"stick")?L(t,"%")?n+n*r/100:n+r:L(t,"%")?r*n/100:r)}return function(){return this.eachLayer(t),this}}(),xe.paint=function(){function t(t){t.live&&t.render()}return function(){return this.eachLayer(t),this}}(),xe.toString=function(){return"Chill Scene"};var Te=yt.prototype=l();Te.constructor=yt,Te.elementType="AbstractElement",Te.elementName="Abstract",Te.type=null,Te.use=null,Te.args=null,Te.instantiate=function(){var t=ce.getInstantiatable(this.type),e=null;return c(t)||(e=new(Function.prototype.bind.apply(t,this.args)),e.edit(this.use)),e},ce.addType(Te.elementName,yt,!1,!1);var we=gt.prototype=Object.create(at.prototype);we.constructor=gt,we.elementType="ContainerElement",we.elementName="Container",we.draw=function(t){var e=this.background;return o(e)&&e.length>0&&(t.beginPath(),t.fillStyle=e,t.fillRect(this.screenX,this.screenY,this.renderWidth,this.renderHeight)),this};var Le=l();Le.width="fit",Le.height="fit",ce.addType(we.elementName,gt,!0,!0),le.set(we.elementType,Le);var Ee=bt.prototype=Object.create(at.prototype);Ee.constructor=bt,Ee.elementType="PolygonElement",Ee.elementName="Polygon",Ee.vertices=null,Ee.fill="",Ee.strokeWidth=1,Ee.strokeColor="#000000",Ee.draw=function(t){var e=this.vertices,n=0,r=e.length,i=this.screenX,s=this.screenY,o=this.renderWidth,a=this.renderHeight;if(r>0){for(t.beginPath(),t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.moveTo(i+e[n][0]*o,s+e[n][1]*a),++n;r>n;n++)t.lineTo(i+e[n][0]*o,s+e[n][1]*a);r>2&&(t.closePath(),this.fill&&(t.fillStyle=this.fill,t.fill())),t.stroke()}return this};var Se=le.fromPrototype(Ee,["elementType","elementName"]);ce.addType(Ee.elementName,bt,!1,!0),le.set(Ee.elementType,Se);var Oe=xt.prototype=Object.create(bt.prototype);Oe.constructor=xt,Oe.elementType="LineElement",Oe.elementName="Line",ce.addType(Oe.elementName,xt,!0,!0);var je=Tt.prototype=Object.create(bt.prototype);je.constructor=Tt,je.elementType="TriangleElement",je.elementName="Triangle",ce.addType(je.elementName,Tt,!0,!0);var ke=wt.prototype=Object.create(bt.prototype);ke.constructor=wt,ke.elementType="RectangleElement",ke.elementName="Rectangle",ce.addType(ke.elementName,wt,!0,!0);var Ce=Lt.prototype=Object.create(bt.prototype);Ce.constructor=Lt,Ce.elementType="PentagonElement",Ce.elementName="Pentagon",ce.addType(Ce.elementName,Lt,!0,!0);var We=Et.prototype=Object.create(bt.prototype);We.constructor=Et,We.elementType="HexagonElement",We.elementName="Hexagon",ce.addType(We.elementName,Et,!0,!0);var Pe=St.prototype=Object.create(bt.prototype);Pe.constructor=St,Pe.elementType="StarElement",Pe.elementName="Star",ce.addType(Pe.elementName,St,!0,!0);var Ae=Ot.prototype=Object.create(at.prototype);Ae.constructor=Ot,Ae.elementType="CircleElement",Ae.elementName="Circle",Ae.r=10,Ae.fill="",Ae.strokeWidth=1,Ae.strokeColor="#000000",Ae.measureWidth=function(){return 2*this.r},Ae.measureHeight=function(){return 2*this.r},Ae.draw=function(t){return t.beginPath(),t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.arc(this.screenX+this.r,this.screenY+this.r,this.r,0,2*Math.PI,!0),t.stroke(),""!==this.fill&&(t.fillStyle=this.fill,t.fill()),this};var Xe=le.fromPrototype(Ae,["elementType","elementName"]);Xe.width="auto",Xe.height="auto",ce.addType(Ae.elementName,Ot,!0,!0),le.set(Ae.elementType,Xe);var Ye=jt.prototype=Object.create(at.prototype);Ye.constructor=jt,Ye.elementType="EllipseElement",Ye.elementName="Ellipse",Ye.fill="",Ye.strokeWidth=1,Ye.strokeColor="#000000",Ye.draw=function(t){var e=.5522848,n=this.renderWidth/2,r=this.renderHeight/2,i=this.screenX,s=this.screenY,o=n*e,a=r*e,h=i+n,c=s+r,u=h+n,l=c+r;return t.beginPath(),t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.moveTo(i,c),t.bezierCurveTo(i,c-a,h-o,s,h,s),t.bezierCurveTo(h+o,s,u,c-a,u,c),t.bezierCurveTo(u,c+a,h+o,l,h,l),t.bezierCurveTo(h-o,l,i,c+a,i,c),t.stroke(),""!==this.fill&&(t.fillStyle=this.fill,t.fill()),this};var Re=le.fromPrototype(Ye,["elementType","elementName"]);ce.addType(Ye.elementName,jt,!0,!0),le.set(Ye.elementType,Re);var Be=kt.prototype=Object.create(at.prototype);Be.constructor=kt,Be.elementType="TextElement",Be.elementName="Text",Be.text=null,Be.textColor="#000000",Be.textIndent=0,Be.textDecoration="none",Be.textTransform="none",Be.textShadow="none",Be.fontFamily="sans-serif",Be.fontSize=12,Be.fontWeight="normal",Be.fontStyle="normal",Be.letterSpacing=0,Be.textAlign="left",Be.textBaseline="top",Be.lineHeight="auto",Be.measureWidth=function(){var t,e=me.ctx,n=0,r=this.getLines(),i=0,s=r.length;for(e.font=this.getFontDescriptor();s>i;i++)t=e.measureText(r[i]).width,t>n&&(n=t);return n},Be.measureHeight=function(){return this.getLines().length*this.getLineHeight()},Be.draw=function(t){var e=this.getLines(),n=1,r=e.length,i=this.getLineHeight(),s=this.screenX,o=this.screenY+(i-this.fontSize)/2,a=this.textAlign;for(t.beginPath(),t.font=this.getFontDescriptor(),t.textAlign=a,t.textBaseline="top",t.fillStyle=this.textColor,"center"===a&&(s+=this.renderWidth/2),"right"===a&&(s+=this.renderWidth),t.fillText(e[0],s+this.textIndent,o);r>n;n++)t.fillText(e[n],s,o+=i);return this},Be.getFontDescriptor=function(){var t="";return"bold"===this.fontWeight&&(t+="bold "),"italic"===this.fontStyle&&(t+="italic "),t+=this.fontSize+"px ",t+=this.fontFamily},Be.getTransformedText=function(){var t=String(this.text);switch(this.textTransform){case"lowercase":t=t.toLowerCase();break;case"uppercase":t=t.toUpperCase();break;case"capitalize":t=Ht(t)}return this.letterSpacing>0&&(t=t.split("").join(v(" ",this.letterSpacing))),t},Be.getLineHeight=function(){var t=this.lineHeight;return"auto"===t?this.fontSize:p(t)?Bt(t,this.fontSize):a(m(t))?m(t):0},Be.getLines=function(){return this.getTransformedText().split(Xt)};var Ie=le.fromPrototype(Be,["elementType","elementName"]);Ie.width="auto",Ie.height="auto",ce.addType(Be.elementName,kt,!0,!0),le.set(Be.elementType,Ie);var He=Ct.prototype=Object.create(at.prototype);He.constructor=Ct,He.elementType="ImageElement",He.elementName="Image",He.sourceX=0,He.sourceY=0,He.sourceWidth="100%",He.sourceHeight="100%",He.img=null,Object.defineProperty(He,"src",{get:function(){return this.img.src},set:function(t){return w(t,"#")&&(t=pe.getByID(K.IMG,t.slice(1)).src),this.img.src=t}}),He.measureWidth=function(){var t=this.sourceWidth;return a(t)?t:p(t)?Bt(t,this.img.width):this.img.width},He.measureHeight=function(){var t=this.sourceHeight;return a(t)?t:p(t)?Bt(t,this.img.height):this.img.height},He.draw=function(t){var e,n,r=this.img;return r.complete===!0&&(p(e=this.sourceX)&&(e=Bt(e,r.width)),p(n=this.sourceY)&&(n=Bt(n,r.height)),t.drawImage(r,e,n,this.measureWidth(),this.measureHeight(),this.screenX,this.screenY,this.renderWidth,this.renderHeight)),this};var Me=le.fromPrototype(He,["elementType","elementName"]);Me.width="auto",Me.height="auto",ce.addType(He.elementName,Ct,!0,!0),le.set(He.elementType,Me);var Ne=Wt.prototype=Object.create(at.prototype);Ne.constructor=Wt,Ne.elementType="PatternElement",Ne.elementName="Pattern",Ne.sourceX=0,Ne.sourceY=0,Ne.sourceWidth="100%",Ne.sourceHeight="100%",Ne.img=null,Object.defineProperty(Ne,"src",{get:function(){return this.img.src},set:function(t){return w(t,"#")&&(t=pe.getByID(K.IMG,t.slice(1)).src),this.img.src=t}}),Ne.repeat="repeat",Ne.measureWidth=function(){var t=this.sourceWidth;return a(t)?t:p(t)?Bt(t,this.img.width):this.img.width},Ne.measureHeight=function(){var t=this.sourceHeight;return a(t)?t:p(t)?Bt(t,this.img.height):this.img.height},Ne.draw=function(t){var e,n,r=this.img;return r.complete===!0&&(p(e=this.sourceX)&&(e=Bt(e,r.width)),p(n=this.sourceY)&&(n=Bt(n,r.height)),t.rect(this.screenX,this.screenY,this.renderWidth,this.renderHeight),t.fillStyle=t.createPattern(r,this.repeat),t.fill()),this};var Fe=le.fromPrototype(Ne,["elementType","elementName"]);Fe.width="auto",Fe.height="auto",ce.addType(Ne.elementName,Wt,!0,!0),le.set(Ne.elementType,Fe);var De=Pt.prototype=Object.create(at.prototype);De.constructor=Pt,De.elementType="SpriteSheetElement",De.elementName="SpriteSheet",De.sourceX=0,De.sourceY=0,De.frameWidth=0,De.frameHeight=0,De.img=null,Object.defineProperty(De,"src",{get:function(){return this.img.src},set:function(t){return w(t,"#")&&(t=pe.getByID(K.IMG,t.slice(1)).src),this.img.src=t}}),De.animations=null,De.frames=null,De.tick=0,De.currentAnimation="default",De.currentFrame=0,De.currentAnimationFrame=null,De.frameRate=7,De.frameSpacing=0,De.paused=!1,De.addAnimation=function(t,e){return this.animations[t]=l(),A(this.animations[t],{frames:[],next:t,frameRate:this.frameRate,direction:"forward"}),this.editAnimation(t,e)},De.editAnimation=function(t,e){var r;return X(this.animations,t)&&(r=this.animations[t],n(e.frames)&&(S(r.frames),r.frames.push.apply(r.frames,e.frames)),o(e.next)&&(r.next=e.next),a(e.frameRate)&&(r.frameRate=e.frameRate),"forward"!==e.direction&&"backward"!==e.direction||(r.direction=e.direction)),this},De.removeAnimation=function(t){return delete this.animations[t],this},De.setFrameSize=function(t,e,n,r){var i=0,s=0;return a(n)&&a(r)?(i=n,s=r):this.img.complete===!0&&(i=this.img.width,s=this.img.height),this.frameWidth=i/e-2*this.frameSpacing,this.frameHeight=s/t-2*this.frameSpacing,this.setFrames()},De.setFrames=function(t){var e,n,r,i,s,o,h,c,u,l;if(this.img.complete===!0){e=0,a(t)||(t=1/0),S(this.frames),o=this.img.width,h=this.img.height,p(n=this.sourceX)&&(n=Bt(n,this.frameWidth)),p(r=this.sourceY)&&(r=Bt(r,this.frameHeight));t:for(s=r;h>s;s+=this.frameHeight)for(i=n;o>i;i+=this.frameWidth)if(this.frames.push({x:i,y:s}),++e>=t)break t}else c=this,u=f(arguments),l=function(){c.setFrames.apply(c,u),c.img.removeEventListener("load",l)},this.img.addEventListener("load",l);return this},De.start=function(){return this.paused=!1,this},De.stop=function(){return this.paused=!0,this},De.measureWidth=function(){var t=this.frameWidth;return p(t)?Bt(t,this.img.width):t},De.measureHeight=function(){var t=this.frameHeight;return p(t)?Bt(t,this.img.height):t},De.draw=function(t){var e,n,r,i,s,o=this.img;return o.complete===!0&&(p(e=this.frameWidth)&&(e=Bt(e,o.width)),p(n=this.frameHeight)&&(n=Bt(n,o.height)),this.paused===!1&&X(this.animations,this.currentAnimation)&&(r=this.animations[this.currentAnimation],s=r.frames,i=a(r.frameRate)?r.frameRate:this.frameRate,++this.tick>=i&&s.length>0&&("backward"===r.direction?--this.currentFrame<=0&&(r.next===this.currentAnimation&&r.loop===!0?this.currentFrame=s.length-1:(X(this.animations,r.next)&&(this.currentAnimation=r.next),this.currentFrame=0)):++this.currentFrame>=s.length&&(r.next===this.currentAnimation&&r.loop===!0?this.currentFrame=0:(X(this.animations,r.next)&&(this.currentAnimation=r.next),this.currentFrame=0)),this.currentAnimationFrame=this.frames[s[this.currentFrame]],this.tick=0)),t.drawImage(o,this.currentAnimationFrame.x,this.currentAnimationFrame.y,e,n,this.screenX,this.screenY,this.renderWidth,this.renderHeight)),this};var ze=l();ze.width="auto",ze.height="auto",ze.frameRate=De.frameRate,ce.addType(De.elementName,Pt,!0,!0),le.set(De.elementType,ze);var qe=l();qe.App=function(t){this.appData=t};var Qe=qe.App.prototype=l();Qe.constructor=qe.App,Qe.appData=null,Qe.toString=function(){return"Chill App"},qe.Debugger=function(t){this.scene=t};var Ue=qe.Debugger.prototype=l();Ue.constructor=qe.Debugger,Ue.scene=null,Ue.addElements=function(t,e,n,r){var s=i(r);return n=h(n)?"Text":n,T(e,function(e){var i=t.create(n);t.add(i),s&&r(i,e)}),this.scene},qe.out=function(t,e,n){var r;return o(e)&&(e=Mt.getElementById(e)),u(e,HTMLElement)||x("the given wrapper not an html element"),e.children.length>0&&b("wrapper should be empty"),e.classList.add("chill-wrapper"),r=new ut(e),t instanceof qe.App||b("app not instance of Chill\\App"),r.include(t.appData,n),r},qe.createClass=ae.createClass,qe.createMask=function(t,e){return i(e)&&de.set(t,e),this},qe.createAbstractElement=ae.createAbstractElement,qe.createPlugin=function(t,e,n,r){var o,a,h=fe.has(t);return h&&r!==!0?b('plugin "'+t+'" already exists'):i(e)?(o=l(),a=l(),s(n)&&A(a,n),o.constructor=e,o.config=a,fe.set(t,o)):b("invalid plugin constructor type"),this},qe.createElementType=function(t,e){var n,r,o;return s(e)&&(i(e.constructor)?ce.hasType(t)?b('Cannot create "'+t+'", type already exists'):(n=ce.getExtendable(e["extends"]),c(n)&&(h(e["extends"])||b('Cannot extend "'+e["extends"]+'", type does not exists, fall back to default: Element'),n=at),r=Object.create(n.prototype),o=function(){var t=f(arguments);n.apply(this,t),e.constructor.apply(this,t)},i(e.prototype)?e.prototype.call(r):s(e.prototype)&&A(r,e.prototype),o.prototype=r,o.prototype.constructor=o,ce.addType(t,o,e.instantiatable,e.extendable)):b("Constructor is required to create a new element type")),this},t.Chill=qe}(this);